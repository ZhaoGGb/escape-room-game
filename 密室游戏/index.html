<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>3Då¯†å®¤é€ƒè„± - æ²‰æµ¸å¼ä½“éªŒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: #0a0a0a;
            color: #fff;
            overflow: hidden;
            user-select: none;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
        }

        canvas {
            display: block;
        }

        .ui-overlay {
            position: fixed;
            z-index: 100;
            pointer-events: none;
        }

        .ui-overlay * {
            pointer-events: auto;
        }

        /* é¡¶éƒ¨æ§åˆ¶æ  */
        .top-controls {
            top: 0;
            left: 0;
            right: 0;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(180deg, rgba(0,0,0,0.7) 0%, transparent 100%);
        }

        .game-title {
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            color: #00ff88;
            letter-spacing: 2px;
        }

        .view-controls {
            display: flex;
            gap: 10px;
        }

        .ctrl-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid rgba(0, 255, 136, 0.5);
            background: rgba(0, 0, 0, 0.6);
            color: #00ff88;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .ctrl-btn:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
        }

        .ctrl-btn:active {
            transform: scale(0.95);
        }

        .timer-display {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 8px 15px;
            color: #00ff88;
            font-size: 1rem;
            font-weight: bold;
            font-family: monospace;
        }

        .timer-display.warning {
            color: #ffaa00;
            border-color: rgba(255, 170, 0, 0.5);
            animation: pulse-warning 1s ease-in-out infinite;
        }

        .timer-display.danger {
            color: #ff4444;
            border-color: rgba(255, 68, 68, 0.5);
            animation: pulse-danger 0.5s ease-in-out infinite;
        }

        @keyframes pulse-warning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes pulse-danger {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .timer-icon {
            font-size: 1.1rem;
        }

        /* å›°éš¾æ¨¡å¼ç‰¹æ®Šæ ·å¼ */
        .hard-mode {
            --primary-color: #ff4444;
            --bg-color: #1a0a0a;
        }

        .hard-mode body {
            background: linear-gradient(135deg, #1a0a0a 0%, #2d0a0a 50%, #1a0a0a 100%);
        }

        .hard-mode .game-title {
            color: #ff4444;
            text-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
        }

        .hard-mode .ctrl-btn {
            border-color: rgba(255, 68, 68, 0.5);
            color: #ff4444;
        }

        .hard-mode .ctrl-btn:hover {
            background: rgba(255, 68, 68, 0.2);
            border-color: #ff4444;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.4);
        }

        .hard-mode .hint-text {
            color: rgba(255, 150, 150, 0.7);
        }

        .hard-mode .modal-hint {
            background: rgba(255, 68, 68, 0.1);
            border-left-color: #ff4444;
        }

        .hard-mode .password-display {
            border-color: #ff4444;
            color: #ff4444;
        }

        .hard-mode .key-btn:hover {
            background: rgba(255, 68, 68, 0.3);
            border-color: #ff4444;
        }

        .hard-mode .key-enter:hover {
            background: rgba(255, 68, 68, 0.4);
            border-color: #ff4444;
        }

        .hard-mode .inventory-item:hover {
            background: rgba(255, 68, 68, 0.1);
            border-color: #ff4444;
        }

        /* åº•éƒ¨ä¿¡æ¯æ  */
        .bottom-info {
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 100%);
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }

        .hint-text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            max-width: 300px;
            line-height: 1.5;
        }

        .stats {
            display: flex;
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .stat-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* ç‰©å“ä¿¡æ¯å¼¹çª— */
        .item-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(10, 15, 20, 0.95);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 20px;
            padding: 30px;
            min-width: 320px;
            max-width: 90vw;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 40px rgba(0, 255, 136, 0.1);
        }

        .item-modal.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
        }

        .modal-title {
            font-size: 1.3rem;
            color: #00ff88;
            font-weight: bold;
        }

        .close-btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 100, 100, 0.3);
            transform: rotate(90deg);
        }

        .modal-content {
            color: rgba(255, 255, 255, 0.85);
            line-height: 1.8;
            font-size: 0.95rem;
        }

        .modal-content p {
            margin-bottom: 15px;
        }

        .modal-hint {
            background: rgba(0, 255, 136, 0.1);
            border-left: 3px solid #00ff88;
            padding: 12px 15px;
            margin-top: 20px;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
        }

        .password-display {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 15px;
            font-size: 2.5rem;
            text-align: center;
            letter-spacing: 15px;
            color: #00ff88;
            margin: 20px 0;
            font-family: monospace;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 250px;
            margin: 0 auto;
        }

        .key-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 15px;
            font-size: 1.3rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .key-btn:hover {
            background: rgba(0, 255, 136, 0.3);
            border-color: #00ff88;
            transform: scale(1.05);
        }

        .key-btn:active {
            transform: scale(0.95);
        }

        .key-clear {
            background: rgba(255, 100, 100, 0.2);
            border-color: rgba(255, 100, 100, 0.5);
        }

        .key-clear:hover {
            background: rgba(255, 100, 100, 0.4);
            border-color: #ff6464;
        }

        .key-enter {
            background: rgba(0, 255, 136, 0.2);
            border-color: rgba(0, 255, 136, 0.5);
        }

        .key-enter:hover {
            background: rgba(0, 255, 136, 0.4);
            border-color: #00ff88;
        }

        /* åŠ è½½ç•Œé¢ */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #0a0a0a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-title {
            font-size: 2rem;
            color: #00ff88;
            margin-bottom: 40px;
            text-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading-progress {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00cc6a);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
        }

        .loading-text {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        /* æ”¶è—å“é¢æ¿ */
        .inventory-panel {
            position: fixed;
            right: -400px;
            top: 0;
            bottom: 0;
            width: 350px;
            background: rgba(10, 15, 20, 0.95);
            border-left: 1px solid rgba(0, 255, 136, 0.2);
            z-index: 150;
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            display: flex;
            flex-direction: column;
        }

        .inventory-panel.active {
            right: 0;
        }

        .inventory-header {
            padding: 25px;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .inventory-title {
            font-size: 1.2rem;
            color: #00ff88;
            font-weight: bold;
        }

        .inventory-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .inventory-empty {
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            padding: 40px 20px;
        }

        .inventory-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .inventory-item:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff88;
            transform: translateX(-5px);
        }

        .inventory-item-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .inventory-item-name {
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
        }

        .inventory-item-desc {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.6);
        }

        /* æ“ä½œæç¤º */
        .action-hint {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 255, 136, 0.9);
            color: #000;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 150;
        }

        .action-hint.visible {
            opacity: 1;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-title {
                font-size: 1.1rem;
            }

            .ctrl-btn {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }

            .bottom-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .hint-text {
                max-width: 100%;
            }

            .stats {
                width: 100%;
                justify-content: space-around;
            }

            .item-modal {
                min-width: 280px;
                padding: 20px;
            }

            .inventory-panel {
                width: 100%;
                right: -100%;
            }
        }

        /* æˆåŠŸæç¤º */
        .success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 500;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        .success-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .success-icon {
            font-size: 5rem;
            margin-bottom: 30px;
            animation: bounce 0.6s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .success-title {
            font-size: 2.5rem;
            color: #00ff88;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
        }

        .success-text {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
            margin-bottom: 40px;
        }

        .restart-btn {
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            border: none;
            color: #000;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.4);
        }

        /* æ§åˆ¶è¯´æ˜ */
        .controls-help {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            z-index: 100;
        }

        .controls-help p {
            margin: 5px 0;
        }

        .controls-help span {
            color: #00ff88;
        }
    </style>
</head>
<body>
    <!-- å¼€å§‹ç•Œé¢ -->
    <div class="start-screen" id="startScreen">
        <div class="start-content">
            <h1 class="start-title">ğŸ” 3Då¯†å®¤é€ƒè„±</h1>
            <p class="start-subtitle">é€‰æ‹©ä½ çš„æŒ‘æˆ˜éš¾åº¦</p>
            
            <div class="difficulty-buttons">
                <button class="difficulty-btn easy-btn" id="easyBtn">
                    <span class="btn-icon">ğŸŒ±</span>
                    <span class="btn-text">ç®€å•æ¨¡å¼</span>
                    <span class="btn-desc">æœ‰çº¿ç´¢æç¤º Â· æ— æ—¶é—´é™åˆ¶</span>
                </button>
                
                <button class="difficulty-btn hard-btn" id="hardBtn">
                    <span class="btn-icon">ğŸ”¥</span>
                    <span class="btn-text">å›°éš¾æ¨¡å¼</span>
                    <span class="btn-desc">æ— çº¿ç´¢æç¤º Â· 5åˆ†é’Ÿé™æ—¶</span>
                </button>
            </div>
            
            <div class="records-section">
                <h3>ğŸ† æœ€ä½³çºªå½•</h3>
                <div class="records">
                    <div class="record-item">
                        <span class="record-label">ç®€å•æ¨¡å¼</span>
                        <span class="record-value" id="easyRecord">--:--</span>
                    </div>
                    <div class="record-item">
                        <span class="record-label">å›°éš¾æ¨¡å¼</span>
                        <span class="record-value" id="hardRecord">--:--</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* å›°éš¾æ¨¡å¼ä¸“å±æ ·å¼ */
        body.hard-mode {
            background: linear-gradient(135deg, #1a0505 0%, #000000 100%);
            animation: pulse-bg 10s infinite alternate;
        }

        @keyframes pulse-bg {
            0% { background-color: #1a0505; }
            100% { background-color: #2a0a0a; }
        }

        .hard-mode .timer-display {
            color: #ff3333;
            text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        }

        .hard-mode .timer-warning {
            animation: panic-flash 0.5s infinite;
        }

        @keyframes panic-flash {
            0%, 100% { color: #ff0000; text-shadow: 0 0 20px red; transform: scale(1); }
            50% { color: #fff; text-shadow: 0 0 30px white; transform: scale(1.1); }
        }

        /* ç¬”è®°ç³»ç»Ÿ */
        .note-btn {
            position: fixed;
            left: 20px;
            top: 80px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #ffd700;
            color: #ffd700;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 100;
            display: none; /* é»˜è®¤éšè—ï¼Œå›°éš¾æ¨¡å¼æ˜¾ç¤º */
        }

        .note-panel {
            position: fixed;
            left: -320px;
            top: 0;
            bottom: 0;
            width: 300px;
            background: rgba(10, 10, 10, 0.95);
            border-right: 2px solid #555;
            padding: 20px;
            transition: left 0.3s ease;
            z-index: 1001;
            overflow-y: auto;
            color: #ccc;
        }

        .note-panel.visible {
            left: 0;
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .note-content h4 {
            color: #ffd700;
            margin-top: 15px;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .note-item {
            font-size: 0.85rem;
            margin-bottom: 5px;
            padding-left: 15px;
            position: relative;
        }

        .note-item::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            color: #555;
        }

        .note-item.verified { color: #4caf50; }
        .note-item.suspicious { color: #ff5722; text-decoration: line-through; }
        .note-item.clue-real { border-left: 2px solid #4caf50; padding-left: 10px; }
        .note-item.clue-fake { border-left: 2px solid #f44336; padding-left: 10px; }

        /* çº¿ç´¢æ¨¡æ€æ¡†æ ·å¼å¢å¼º */
        .modal-content.clue-modal {
            max-width: 600px;
            background: #1a1a1a;
            border: 1px solid #333;
        }

        .clue-visual {
            width: 100%;
            height: 200px;
            background: #000;
            margin: 10px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .painting-canvas {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .color-sample {
            display: inline-block;
            width: 15px;
            height: 15px;
            border: 1px solid #fff;
            margin-right: 5px;
            vertical-align: middle;
        }

        /* é”å±ç•Œé¢ */
        .lock-screen {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: red;
            font-size: 2rem;
        }

        /* åŸæœ‰æ ·å¼... */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .start-screen.hidden {
            opacity: 0;
            pointer-events: none;
            transform: scale(1.1);
        }

        .start-content {
            text-align: center;
            padding: 40px;
            max-width: 400px;
            width: 90%;
        }

        .start-title {
            font-size: 2.2rem;
            color: #00ff88;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(0, 255, 136, 0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 30px rgba(0, 255, 136, 0.5); }
            to { text-shadow: 0 0 50px rgba(0, 255, 136, 0.8); }
        }

        .start-subtitle {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 30px;
        }

        .difficulty-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
        }

        .difficulty-btn {
            position: relative;
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .difficulty-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .difficulty-btn:hover::before {
            left: 100%;
        }

        .easy-btn {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            color: #000;
        }

        .easy-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(0, 255, 136, 0.4);
        }

        .hard-btn {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: #fff;
        }

        .hard-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 68, 68, 0.4);
        }

        .hard-btn:active {
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateY(-3px) rotate(0); }
            25% { transform: translateY(-3px) rotate(-1deg); }
            75% { transform: translateY(-3px) rotate(1deg); }
        }

        .btn-icon {
            font-size: 1.8rem;
            display: block;
            margin-bottom: 5px;
        }

        .btn-text {
            font-size: 1.2rem;
            font-weight: bold;
            display: block;
            margin-bottom: 5px;
        }

        .btn-desc {
            font-size: 0.85rem;
            opacity: 0.8;
            display: block;
        }

        .records-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .records-section h3 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .records {
            display: flex;
            justify-content: center;
            gap: 40px;
        }

        .record-item {
            text-align: center;
        }

        .record-label {
            display: block;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 5px;
        }

        .record-value {
            display: block;
            font-size: 1.2rem;
            color: #00ff88;
            font-weight: bold;
        }

        /* å›°éš¾æ¨¡å¼èƒŒæ™¯ */
        .hard-mode .start-screen {
            background: linear-gradient(135deg, #1a0a0a 0%, #2d0a0a 50%, #1a0a0a 100%);
        }

        .hard-mode .start-title {
            color: #ff4444;
            text-shadow: 0 0 30px rgba(255, 68, 68, 0.5);
        }

        @media (max-width: 768px) {
            .start-title {
                font-size: 2rem;
            }
            
            .difficulty-btn {
                padding: 20px;
            }
            
            .btn-icon {
                font-size: 2rem;
            }
            
            .btn-text {
                font-size: 1.2rem;
            }
        }
    </style>

    <!-- é¦–æ¬¡è¿›å…¥æç¤º -->
    <div class="sound-prompt" id="soundPrompt">
        <div class="sound-prompt-content">
            <span style="font-size: 3rem; margin-bottom: 15px;">ğŸ”Š</span>
            <p style="font-size: 1.1rem; margin-bottom: 10px;">ç‚¹å‡»ä»»æ„å¤„å¼€å¯å£°éŸ³</p>
            <p style="font-size: 0.85rem; opacity: 0.7;">è·å¾—æ›´å¥½çš„æ¸¸æˆä½“éªŒ</p>
        </div>
    </div>

    <!-- æ¸¸æˆå¤±è´¥ç•Œé¢ -->
    <div class="game-over-screen" id="gameOverScreen">
        <div class="game-over-content">
            <h1 class="game-over-title">â° æ—¶é—´åˆ°ï¼</h1>
            <p class="game-over-subtitle">ä½ åœ¨è§„å®šæ—¶é—´å†…æœªèƒ½é€ƒè„±</p>
            <div class="failed-password">
                <p>æ­£ç¡®ç­”æ¡ˆï¼š</p>
                <div class="password-reveal" id="failedPassword">----</div>
            </div>
            <button class="retry-btn" id="retryBtn">ğŸ”„ å†è¯•ä¸€æ¬¡</button>
        </div>
    </div>

    <!-- åŠ è½½ç•Œé¢ -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-title">ğŸ” å¯†å®¤é€ƒè„±</div>
        <div class="loading-progress">
            <div class="loading-bar" id="loadingBar"></div>
        </div>
        <div class="loading-text" id="loadingText">æ­£åœ¨åˆå§‹åŒ–åœºæ™¯...</div>
    </div>

    <style>
        .game-over-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        .game-over-screen.active {
            opacity: 1;
            visibility: visible;
        }

        .game-over-content {
            text-align: center;
            padding: 40px;
            max-width: 450px;
        }

        .game-over-title {
            font-size: 2.5rem;
            color: #ff4444;
            margin-bottom: 15px;
            text-shadow: 0 0 30px rgba(255, 68, 68, 0.5);
            animation: pulse-red 1s ease-in-out infinite;
        }

        @keyframes pulse-red {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .game-over-subtitle {
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 40px;
        }

        .failed-password {
            background: rgba(255, 68, 68, 0.1);
            border: 2px solid rgba(255, 68, 68, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 40px;
        }

        .failed-password p {
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 15px;
        }

        .password-reveal {
            font-size: 2.5rem;
            color: #ff4444;
            letter-spacing: 15px;
            font-family: monospace;
            font-weight: bold;
        }

        .retry-btn {
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            border: none;
            color: #fff;
            padding: 18px 50px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .retry-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(255, 68, 68, 0.4);
        }
    </style>

    <style>
        .sound-prompt {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 600;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .sound-prompt.visible {
            opacity: 1;
            visibility: visible;
        }

        .sound-prompt-content {
            text-align: center;
            color: #fff;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>

    <!-- 3Dåœºæ™¯å®¹å™¨ -->
    <div id="canvas-container"></div>

    <!-- é¡¶éƒ¨æ§åˆ¶æ  -->
    <div class="ui-overlay top-controls">
        <div style="display: flex; align-items: center; gap: 10px;">
            <button class="ctrl-btn" id="muteBtn" title="é™éŸ³">ğŸ”Š</button>
            <div class="timer-display" id="timerDisplay" style="display: none;">
                <span class="timer-icon">â±ï¸</span>
                <span class="timer-value" id="timerValue">05:00</span>
            </div>
        </div>
        <div class="game-title">ğŸ” 3Då¯†å®¤é€ƒè„±</div>
        <div class="view-controls">
            <button class="ctrl-btn" id="resetViewBtn" title="é‡ç½®è§†è§’">ğŸ”„</button>
            <button class="ctrl-btn" id="inventoryBtn" title="ç‰©å“æ ">ğŸ’</button>
            <button class="ctrl-btn" id="helpBtn" title="å¸®åŠ©">â“</button>
        </div>
    </div>

    <!-- åº•éƒ¨ä¿¡æ¯æ  -->
    <div class="ui-overlay bottom-info">
        <div class="hint-text">
            ğŸ–±ï¸ å·¦é”®æ‹–åŠ¨æ—‹è½¬ | æ»šè½®ç¼©æ”¾ | å³é”®å¹³ç§» | ç‚¹å‡»ç‰©å“æŸ¥çœ‹è¯¦æƒ…
        </div>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="fpsValue">60</div>
                <div class="stat-label">FPS</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="objectsCount">0</div>
                <div class="stat-label">ç‰©ä½“æ•°</div>
            </div>
        </div>
    </div>

    <!-- æ§åˆ¶è¯´æ˜ -->
    <div class="controls-help">
        <p><span>ğŸ–±ï¸ æ‹–åŠ¨</span> æ—‹è½¬è§†è§’</p>
        <p><span>ğŸ” æ»šè½®</span> ç¼©æ”¾æŸ¥çœ‹</p>
        <p><span>ğŸ‘† ç‚¹å‡»</span> ç‰©å“äº¤äº’</p>
    </div>

    <!-- ç‰©å“è¯¦æƒ…å¼¹çª— -->
    <div class="item-modal" id="itemModal">
        <div class="modal-header">
            <div class="modal-title" id="modalTitle">ç‰©å“åç§°</div>
            <button class="close-btn" id="closeModal">Ã—</button>
        </div>
        <div class="modal-content" id="modalContent">
            <!-- ç‰©å“è¯¦æƒ…å†…å®¹ -->
        </div>
    </div>

    <!-- å¯†ç è¾“å…¥æ¨¡æ€æ¡† -->
    <div class="item-modal" id="passwordModal">
        <div class="modal-header">
            <div class="modal-title" id="passwordTitle">ğŸ”’ è¾“å…¥å¯†ç </div>
            <button class="close-btn" id="closePassword">Ã—</button>
        </div>
        <div class="modal-content">
            <p id="passwordHint">è¯·è¾“å…¥4ä½å¯†ç </p>
            <div class="password-display" id="passwordDisplay">----</div>
            <div class="keypad">
                <button class="key-btn" data-digit="1">1</button>
                <button class="key-btn" data-digit="2">2</button>
                <button class="key-btn" data-digit="3">3</button>
                <button class="key-btn" data-digit="4">4</button>
                <button class="key-btn" data-digit="5">5</button>
                <button class="key-btn" data-digit="6">6</button>
                <button class="key-btn" data-digit="7">7</button>
                <button class="key-btn" data-digit="8">8</button>
                <button class="key-btn" data-digit="9">9</button>
                <button class="key-btn key-clear" data-digit="clear">C</button>
                <button class="key-btn" data-digit="0">0</button>
                <button class="key-btn key-enter" data-digit="enter">âœ“</button>
            </div>
        </div>
    </div>

    <!-- ç¬”è®°æŒ‰é’® -->
    <button id="noteBtn" class="note-btn">ğŸ“ ä¾¦æ¢ç¬”è®°</button>

    <!-- ç¬”è®°é¢æ¿ -->
    <div id="notePanel" class="note-panel">
        <div class="note-header">
            <h3>ä¾¦æ¢ç¬”è®°</h3>
            <button id="closeNote" style="background:none;border:none;color:#fff;cursor:pointer;">âœ•</button>
        </div>
        <div id="noteContent" class="note-content">
            <p style="color:#666;font-style:italic;">æš‚æ— è®°å½•...</p>
        </div>
    </div>

    <!-- ç‰©å“æ é¢æ¿ -->
    <div class="inventory-panel" id="inventoryPanel">
        <div class="inventory-header">
            <div class="inventory-title">ğŸ’ æ”¶é›†çš„ç‰©å“</div>
            <button class="close-btn" id="closeInventory">Ã—</button>
        </div>
        <div class="inventory-content" id="inventoryContent">
            <div class="inventory-empty">
                è¿˜æ²¡æœ‰æ”¶é›†ä»»ä½•ç‰©å“<br>
                æ¢ç´¢æˆ¿é—´æ¥å‘ç°çº¿ç´¢å§ï¼
            </div>
        </div>
    </div>

    <!-- æ“ä½œæç¤º -->
    <div class="action-hint" id="actionHint">ç‚¹å‡»ç‰©å“è¿›è¡Œäº¤äº’</div>

    <!-- æˆåŠŸæç¤º -->
    <div class="success-overlay" id="successOverlay">
        <div class="success-icon">ğŸ‰</div>
        <div class="success-title">æˆåŠŸé€ƒè„±ï¼</div>
        <div class="success-text">ä½ å‘ç°äº†æ‰€æœ‰çº¿ç´¢å¹¶æˆåŠŸæ‰“å¼€äº†å¯†å®¤çš„é—¨</div>
        <button class="restart-btn" id="restartBtn">é‡æ–°å¼€å§‹</button>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // ==================== éŸ³æ•ˆç³»ç»Ÿ ====================
        class SoundManager {
            constructor() {
                this.audioContext = null;
                this.isMuted = false;
                this.isInitialized = false;
                this.userHasInteracted = false;
            }

            init() {
                if (this.isInitialized) return;
                
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.isInitialized = true;
                    console.log('éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ');
                } catch (e) {
                    console.warn('Web Audio API ä¸å¯ç”¨:', e);
                }
            }

            resume() {
                if (this.audioContext && this.audioContext.state === 'suspended') {
                    this.audioContext.resume();
                }
            }

            // ç”Ÿæˆæ­£å¼¦æ³¢éŸ³æ•ˆ
            playTone(frequency, duration, type = 'sine', volume = 0.3) {
                if (this.isMuted || !this.audioContext) return;
                
                this.resume();
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.type = type;
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(volume, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }

            // æŒ‰é”®éŸ³ï¼š800Hzæ­£å¼¦æ³¢ï¼Œ0.1ç§’
            playKeySound() {
                this.playTone(800, 0.1, 'sine', 0.25);
            }

            // åˆ é™¤éŸ³ï¼š200Hzä½é¢‘ï¼Œ0.15ç§’
            playDeleteSound() {
                this.playTone(200, 0.15, 'sine', 0.3);
            }

            // é”™è¯¯éŸ³ï¼šå¿«é€Ÿäº¤æ›¿é«˜ä½é¢‘ï¼Œ0.3ç§’
            playErrorSound() {
                if (this.isMuted || !this.audioContext) return;
                
                this.resume();
                const duration = 0.3;
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.type = 'sawtooth';
                
                const now = this.audioContext.currentTime;
                oscillator.frequency.setValueAtTime(150, now);
                oscillator.frequency.setValueAtTime(100, now + 0.05);
                oscillator.frequency.setValueAtTime(150, now + 0.1);
                oscillator.frequency.setValueAtTime(100, now + 0.15);
                oscillator.frequency.setValueAtTime(150, now + 0.2);
                oscillator.frequency.setValueAtTime(100, now + 0.25);
                
                gainNode.gain.setValueAtTime(0.2, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration);
                
                oscillator.start(now);
                oscillator.stop(now + duration);
            }

            // æˆåŠŸéŸ³ï¼š1200Hzâ†’800Hzä¸¤å£°belléŸ³
            playSuccessSound() {
                if (this.isMuted || !this.audioContext) return;
                
                this.resume();
                const now = this.audioContext.currentTime;
                
                // ç¬¬ä¸€å£°
                const osc1 = this.audioContext.createOscillator();
                const gain1 = this.audioContext.createGain();
                osc1.connect(gain1);
                gain1.connect(this.audioContext.destination);
                osc1.type = 'sine';
                osc1.frequency.setValueAtTime(1200, now);
                osc1.frequency.exponentialRampToValueAtTime(800, now + 0.15);
                gain1.gain.setValueAtTime(0.4, now);
                gain1.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc1.start(now);
                osc1.stop(now + 0.3);
                
                // ç¬¬äºŒå£°ï¼ˆå»¶è¿Ÿ0.2ç§’ï¼‰
                const osc2 = this.audioContext.createOscillator();
                const gain2 = this.audioContext.createGain();
                osc2.connect(gain2);
                gain2.connect(this.audioContext.destination);
                osc2.type = 'sine';
                osc2.frequency.setValueAtTime(1000, now + 0.2);
                osc2.frequency.exponentialRampToValueAtTime(600, now + 0.35);
                gain2.gain.setValueAtTime(0.4, now + 0.2);
                gain2.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                osc2.start(now + 0.2);
                osc2.stop(now + 0.5);
            }

            // ç‚¹å‡»ç‰©å“éŸ³ï¼šçŸ­ä¿ƒå™ªå£°
            playClickSound() {
                if (this.isMuted || !this.audioContext) return;
                
                this.resume();
                const duration = 0.08;
                const bufferSize = this.audioContext.sampleRate * duration;
                const buffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufferSize * 0.3));
                }
                
                const source = this.audioContext.createBufferSource();
                const gainNode = this.audioContext.createGain();
                const filter = this.audioContext.createBiquadFilter();
                
                filter.type = 'highpass';
                filter.frequency.value = 1000;
                
                source.buffer = buffer;
                source.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                source.start();
            }

            // éœ‡åŠ¨åé¦ˆ
            vibrate(pattern) {
                if (this.isMuted || !navigator.vibrate) return;
                
                try {
                    navigator.vibrate(pattern);
                } catch (e) {
                    console.warn('éœ‡åŠ¨ä¸å¯ç”¨:', e);
                }
            }

            // æŒ‰é”®è½»éœ‡
            vibrateKey() {
                this.vibrate(30);
            }

            // é”™è¯¯é‡éœ‡
            vibrateError() {
                this.vibrate([100, 50, 100]);
            }

            // æˆåŠŸè¿ç»­ä¸¤æ¬¡è½»éœ‡
            vibrateSuccess() {
                this.vibrate([50, 50, 50, 50]);
            }

            toggleMute() {
                this.isMuted = !this.isMuted;
                return this.isMuted;
            }
        }

        const soundManager = new SoundManager();

        // ==================== éš¾åº¦ç³»ç»Ÿ ====================
        let currentDifficulty = null; // 'easy' | 'hard' | null
        let gameMode = 'menu'; // 'menu' | 'playing' | 'gameover'
        let timerInterval = null;
        let timeRemaining = 300; // 5åˆ†é’Ÿ = 300ç§’
        let timerWarningPlayed = false;
        
        // å…¨å±€å˜é‡å£°æ˜
        let doorPassword = '0000';
        let safePassword = '0000';
        let drawerPassword = '0000';
        
        // å›°éš¾æ¨¡å¼ç‰¹æœ‰å˜é‡
        let hardModeData = {
            truePassword: '',
            cluesFound: [], // å·²å‘ç°çš„çº¿ç´¢
            notes: [],      // ç¬”è®°è®°å½•
            penalties: 0,   // æƒ©ç½šæ¬¡æ•°
            isTrashReal: false, // åƒåœ¾æ¡¶çº¿ç´¢çœŸå‡ (initæ—¶éšæœº)
            lastActionTime: 0, // ä¸Šæ¬¡æ“ä½œæ—¶é—´
            lockoutEndTime: 0, // é”å®šç»“æŸæ—¶é—´
            // åŠ¨æ€é¢œè‰²é˜ˆå€¼ï¼ˆæ¯å±€æ¸¸æˆéšæœºç”Ÿæˆï¼‰
            colorThresholds: {
                redMin: 255,      // Råˆ†é‡æœ€å°å€¼ [240, 255]
                greenMax: 0,       // Gåˆ†é‡æœ€å¤§å€¼ [0, 15]
                blueMax: 0         // Båˆ†é‡æœ€å¤§å€¼ [0, 15]
            }
        };

        const itemDescriptions = {
            door: {
                name: 'æœ¨é—¨',
                description: 'ä¸€æ‰‡åšé‡çš„æœ¨é—¨ï¼Œç´§é”ç€ã€‚é—¨ç¼é‡Œé€ä¸è¿›ä¸€ä¸å…‰çº¿ã€‚',
                hint: 'è¿™æ˜¯é€ƒå‡ºå»çš„å”¯ä¸€å‡ºè·¯ï¼Œä½†éœ€è¦æ‰¾åˆ°é’¥åŒ™...'
            },
            bed: {
                name: 'æ—§åºŠé“º',
                description: 'ä¸€å¼ ç ´æ—§çš„å•äººåºŠï¼ŒåºŠå•å·²ç»å‘é»„ã€‚åºŠå«é‡Œä¼¼ä¹è—ç€ä»€ä¹ˆ...',
                hint: 'ä½ å·²ç»å¾ˆç´¯äº†ï¼Œä½†ç°åœ¨ä¸æ˜¯ä¼‘æ¯çš„æ—¶å€™ã€‚'
            },
            desk: {
                name: 'ä¹¦æ¡Œ',
                description: 'è€æ—§çš„æœ¨ä¹¦æ¡Œï¼Œè¡¨é¢å¸ƒæ»¡äº†åˆ’ç—•ã€‚æŠ½å±‰è¢«é”ä½äº†ã€‚',
                hint: 'ä¹¦æ¡ŒæŠ½å±‰éœ€è¦é’¥åŒ™æ‰èƒ½æ‰“å¼€ã€‚'
            },
            drawer: {
                name: 'ä¹¦æ¡ŒæŠ½å±‰',
                description: 'ä¸€ä¸ªå¸¦é”çš„æŠ½å±‰ï¼Œé”å­”å·²ç»ç”Ÿé”ˆã€‚',
                hint: 'éœ€è¦æ‰¾åˆ°é’¥åŒ™æ‰èƒ½æ‰“å¼€ã€‚'
            },
            lamp: {
                name: 'å°ç¯',
                description: 'ä¸€ç›è€å¼å°ç¯ï¼Œç¯æ³¡å‘å‡ºå¾®å¼±çš„å…‰èŠ’ã€‚',
                hint: 'ç¯å…‰è™½ç„¶æ˜æš—ï¼Œä½†å‹‰å¼ºèƒ½çœ‹æ¸…æˆ¿é—´ã€‚'
            },
            diary: {
                name: 'æ—¥è®°æœ¬',
                description: 'ä¸€æœ¬æ³›é»„çš„æ—¥è®°æœ¬ï¼Œæ‰‰é¡µå†™ç€"è®°ä½ï¼Œæ—¶é—´ä¼šå‘Šè¯‰ä½ ä¸€åˆ‡"ã€‚',
                hint: 'è¿™æœ¬æ—¥è®°ä¼¼ä¹åœ¨æš—ç¤ºä»€ä¹ˆå…³äºæ—¶é—´çš„ä¿¡æ¯...'
            },
            plant: {
                name: 'ç›†æ ½',
                description: 'ä¸€ç›†æ¯èçš„ç»¿æ¤ï¼ŒåœŸå£¤çœ‹èµ·æ¥æœ€è¿‘è¢«åŠ¨è¿‡ã€‚',
                hint: 'ä»”ç»†æ£€æŸ¥åœŸå£¤ï¼Œå¯èƒ½è—ç€ä»€ä¹ˆä¸œè¥¿ã€‚'
            },
            clock: {
                name: 'æŒ‚é’Ÿ',
                description: function() {
                    const now = new Date();
                    const timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                    return `ä¸€ä¸ªè¿˜åœ¨èµ°åŠ¨çš„æŒ‚é’Ÿã€‚<br>å½“å‰æ—¶é—´ï¼š<strong style="color:#ff6b6b;font-size:1.2em;">${timeStr}</strong>`;
                },
                hint: 'æ³¨æ„æ—¶é—´ï¼å®ƒå¯èƒ½æ˜¯è§£å¼€å¯†ç çš„å…³é”®...'
            },
            wardrobe: {
                name: 'è¡£æŸœ',
                description: 'è€æ—§çš„è¡£æŸœï¼Œé‡Œé¢æŒ‚ç€å‡ ä»¶ç ´æ—§çš„è¡£æœã€‚',
                hint: 'è¡£æŸœé‡Œé™¤äº†è¡£æœï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚'
            },
            trash: {
                name: 'åƒåœ¾æ¡¶',
                description: 'ä¸€ä¸ªç”Ÿé”ˆçš„åƒåœ¾æ¡¶ï¼Œé‡Œé¢æœ‰ä¸€äº›æ‰çš±çš„çº¸æ¡ã€‚',
                hint: 'åƒåœ¾æ¡¶é‡Œä¼¼ä¹è—ç€ä»€ä¹ˆä¿¡æ¯...'
            },
            painting: {
                name: 'æ²¹ç”»',
                description: 'ä¸€å¹…ç¥ç§˜çš„æ²¹ç”»ï¼Œç”»ç€é™ç‰©ã€‚',
                hint: 'è¿™å¹…ç”»ä¼¼ä¹éšè—ç€æŸç§è§„å¾‹...'
            },
            safe: {
                name: 'ä¿é™©ç®±',
                description: 'ä¸€ä¸ªé‡‘å±ä¿é™©ç®±ï¼Œéœ€è¦è¾“å…¥5ä½æ•°å­—å¯†ç ã€‚',
                hint: 'å¯†ç ä¼¼ä¹ä¸çº¢è‰²ç‰©å“çš„æ•°é‡å’Œæ—¶é—´æœ‰å…³...'
            },
            envelope: {
                name: 'ç¥ç§˜ä¿¡å°',
                description: 'ä¸€ä¸ªçº¢è‰²çš„ä¿¡å°ï¼Œçœ‹èµ·æ¥å¾ˆç´§æ€¥ã€‚',
                hint: 'ä¿¡å°ä¸Šå†™ç€"ç´§æ€¥ï¼"...'
            },
            carpet: {
                name: 'åœ°æ¯¯',
                description: 'ä¸€å—ç ´æ—§çš„åœ°æ¯¯ï¼Œè¾¹ç¼˜æœ‰äº›ç¿˜èµ·ã€‚',
                hint: 'åœ°æ¯¯ä¸‹é¢ä¼¼ä¹è—ç€ä»€ä¹ˆä¸œè¥¿...'
            },
            key: {
                name: 'é“¶è‰²é’¥åŒ™',
                description: 'ä¸€æŠŠé“¶è‰²çš„å°é’¥åŒ™ã€‚',
                hint: 'è¿™æŠŠé’¥åŒ™çœ‹èµ·æ¥èƒ½æ‰“å¼€ä»€ä¹ˆä¸œè¥¿...'
            }
        };

        const DIFFICULTY_CONFIG = {
            easy: {
                name: 'ç®€å•æ¨¡å¼',
                showHints: true,
                timeLimit: null,
                bgClass: ''
            },
            hard: {
                name: 'å›°éš¾æ¨¡å¼',
                showHints: false,
                timeLimit: 360, // 6åˆ†é’Ÿ
                bgClass: 'hard-mode'
            }
        };

        function startGame(difficulty) {
            currentDifficulty = difficulty;
            gameMode = 'playing';
            
            document.getElementById('startScreen').classList.add('hidden');
            
            document.body.className = DIFFICULTY_CONFIG[difficulty].bgClass;
            
            // å…ˆåˆå§‹åŒ–æ¸¸æˆï¼ˆåŒ…æ‹¬ç”Ÿæˆå¯†ç ï¼‰
            init();
            
            if (difficulty === 'easy') {
                // æ›´æ–°åŠ¨æ€æè¿°ï¼ˆä½¿ç”¨ç”Ÿæˆçš„å¯†ç ï¼‰
                itemData['paper'].description = `ä»åƒåœ¾æ¡¶é‡Œæ‰¾åˆ°çš„çº¸å›¢ï¼Œä¸Šé¢æ½¦è‰åœ°å†™ç€æ•°å­—ï¼š${drawerPassword.slice(0,1)}-${drawerPassword.slice(1,2)}-${drawerPassword.slice(2,3)}-${drawerPassword.slice(3,4)}`;
                itemData['diary'].description = `æ—¥è®°çš„æœ€åä¸€é¡µå†™ç€ï¼š"è®°ä½ï¼Œå¯†ç é”çš„é¡ºåºæ˜¯åçš„..." å¯†ç ï¼š${drawerPassword.slice(0,1)}-${drawerPassword.slice(1,2)}-${drawerPassword.slice(2,3)}-${drawerPassword.slice(3,4)}`;
                itemData['diary'].hint = `å¯†ç é¡ºåºæ˜¯åçš„ï¼${drawerPassword.slice(0,1)}-${drawerPassword.slice(1,2)}-${drawerPassword.slice(2,3)}-${drawerPassword.slice(3,4)}åè¿‡æ¥å°±æ˜¯${doorPassword.slice(0,1)}-${doorPassword.slice(1,2)}-${doorPassword.slice(2,3)}-${doorPassword.slice(3,4)}`;
            } else {
                // å›°éš¾æ¨¡å¼åˆå§‹åŒ–
                initHardMode();
            }
            
            if (difficulty === 'hard') {
                document.getElementById('noteBtn').style.display = 'block';
                itemData['safe'].hint = ''; // æ¸…ç©ºæç¤º
                timeRemaining = DIFFICULTY_CONFIG.hard.timeLimit; // é‡ç½®æ—¶é—´
                startTimer();
                
                // å¯åŠ¨æŒ‚æœºæ£€æµ‹
                hardModeData.lastActionTime = Date.now();
                setInterval(checkAFK, 1000);
            } else {
                document.getElementById('noteBtn').style.display = 'none';
            }
        }

        function restartGame() {
            // å¦‚æœæœ‰è®¡æ—¶å™¨ï¼Œåœæ­¢å®ƒ
            if (currentDifficulty === 'hard') {
                stopTimer();
            }
            
            // é‡æ–°ç”Ÿæˆéšæœºå¯†ç 
            initRandomPasswords();
            if (currentDifficulty !== 'hard') {
                itemData['safe'].hint = `è¾“å…¥å¯†ç  ${safePassword.slice(0,1)}-${safePassword.slice(1,2)}-${safePassword.slice(2,3)}-${safePassword.slice(3,4)} è¯•è¯•çœ‹ï¼`;
            }
            
            // é‡ç½®æ‰€æœ‰æ”¶é›†çŠ¶æ€
            Object.keys(itemData).forEach(key => {
                if (itemData[key].collected) {
                    itemData[key].collected = false;
                }
                if (itemData[key].opened) {
                    itemData[key].opened = false;
                }
            });
            collectedItems = [];
            isGameComplete = false;
            
            // é‡ç½®æ¸¸æˆæ¨¡å¼çŠ¶æ€
            gameMode = 'menu';
            currentDifficulty = null;
            timeRemaining = 300;
            timerWarningPlayed = false;
            
            // é‡ç½®UI
            document.body.className = '';
            document.getElementById('gameOverScreen').classList.remove('active');
            document.getElementById('successOverlay').classList.remove('active');
            document.getElementById('startScreen').classList.remove('hidden');
            
            // é‡æ–°æ˜¾ç¤ºæ‰€æœ‰ç‰©å“
            if (interactiveObjects) {
                interactiveObjects.forEach(obj => {
                    if (obj.name && itemData[obj.name] && itemData[obj.name].canCollect) {
                        obj.visible = true;
                    }
                });
            }
            
            // æ›´æ–°UI
            updateInventory();
            loadBestRecords();
            
            showHint('æ¸¸æˆé‡æ–°å¼€å§‹ï¼é€‰æ‹©éš¾åº¦å¼€å§‹æŒ‘æˆ˜å§ã€‚');
        }

        function gameComplete() {
            if (currentDifficulty === 'hard') {
                stopTimer();
                
                const timeUsed = 300 - timeRemaining;
                saveBestRecord('hard', timeUsed);
            } else {
                saveBestRecord('easy', null);
            }
            
            isGameComplete = true;
            document.getElementById('successOverlay').classList.add('active');
            showHint('ğŸ‰ æ­å–œä½ æˆåŠŸé€ƒè„±ï¼');
            soundManager.playSuccessSound();
            soundManager.vibrateSuccess();
        }

        function gameFailed() {
            gameMode = 'gameover';
            stopTimer();
            
            document.getElementById('failedPassword').textContent = currentDifficulty === 'hard' ? hardModeData.truePassword : doorPassword;
            document.getElementById('gameOverScreen').classList.add('active');
            
            soundManager.playErrorSound();
            soundManager.vibrateError();
        }

        // ==================== å€’è®¡æ—¶ç³»ç»Ÿ ====================
        function startTimer() {
            timeRemaining = currentDifficulty === 'hard' ? 360 : 300;
            timerWarningPlayed = false;
            document.getElementById('timerDisplay').style.display = 'flex';
            updateTimerDisplay();
            
            // å›°éš¾æ¨¡å¼åˆå§‹å¿ƒè·³éŸ³æ•ˆ
            if (currentDifficulty === 'hard') {
                document.body.classList.add('hard-mode-active');
            }
            
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    gameFailed();
                    return;
                }
                
                // å›°éš¾æ¨¡å¼ç‰¹æ•ˆ
                if (currentDifficulty === 'hard') {
                    // æœ€å60ç§’ï¼šçº¢è‰²è¾¹æ¡† + æ€¥ä¿ƒå¿ƒè·³
                    if (timeRemaining <= 60) {
                        document.body.classList.add('urgent');
                        if (timeRemaining % 1 === 0) { // æ¯ç§’æ’­æ”¾
                            soundManager.playTone(100, 0.1, 'sine', 0.5); // æ¨¡æ‹Ÿå¿ƒè·³
                            setTimeout(() => soundManager.playTone(100, 0.1, 'sine', 0.3), 150);
                        }
                    }
                    
                    // è§†è§‰å¹²æ‰°ï¼šå€’è®¡æ—¶é—ªçƒ
                    if (timeRemaining % 10 === 0) {
                        const timerDisplay = document.getElementById('timerDisplay');
                        timerDisplay.style.opacity = '0';
                        setTimeout(() => timerDisplay.style.opacity = '1', 200);
                    }
                }
                
                // æœ€å60ç§’è­¦å‘ŠéŸ³æ•ˆ (åŸæœ‰é€»è¾‘ä¿ç•™ç»™ç®€å•æ¨¡å¼æˆ–é€šç”¨)
                if (currentDifficulty !== 'hard' && timeRemaining <= 60 && timeRemaining > 0 && !timerWarningPlayed) {
                    timerWarningPlayed = true;
                    playTimerWarningSound();
                }
                
                // æœ€å10ç§’å€’è®¡æ—¶éŸ³æ•ˆ
                if (timeRemaining <= 10 && timeRemaining > 0) {
                    playCountdownSound();
                }
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            document.getElementById('timerDisplay').style.display = 'none';
            document.body.classList.remove('hard-mode-active', 'urgent');
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            const timeStr = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('timerValue').textContent = timeStr;
            
            const timerDisplay = document.getElementById('timerDisplay');
            timerDisplay.classList.remove('warning', 'danger');
            
            if (timeRemaining <= 60) {
                timerDisplay.classList.add('danger');
            } else if (timeRemaining <= 120) {
                timerDisplay.classList.add('warning');
            }
        }

        function playTimerWarningSound() {
            if (soundManager.isMuted || !soundManager.audioContext) return;
            soundManager.playTone(440, 0.3, 'sine', 0.2);
            setTimeout(() => soundManager.playTone(440, 0.3, 'sine', 0.2), 400);
        }

        function playCountdownSound() {
            if (soundManager.isMuted || !soundManager.audioContext) return;
            soundManager.playTone(880, 0.1, 'sine', 0.3);
        }

        // ==================== æœ€ä½³çºªå½•ç³»ç»Ÿ ====================
        function saveBestRecord(difficulty, timeUsed) {
            const records = JSON.parse(localStorage.getItem('escapeRoomRecords') || '{}');
            
            if (difficulty === 'easy') {
                const existing = records.easy;
                if (!existing) {
                    records.easy = { completed: true, date: new Date().toLocaleDateString() };
                    localStorage.setItem('escapeRoomRecords', JSON.stringify(records));
                }
            } else if (timeUsed !== null) {
                const existing = records.hard;
                if (!existing || timeUsed < existing.timeUsed) {
                    records.hard = { timeUsed, date: new Date().toLocaleDateString() };
                    localStorage.setItem('escapeRoomRecords', JSON.stringify(records));
                }
            }
            
            loadBestRecords();
        }

        function loadBestRecords() {
            const records = JSON.parse(localStorage.getItem('escapeRoomRecords') || '{}');
            
            // ç®€å•æ¨¡å¼
            if (records.easy) {
                document.getElementById('easyRecord').textContent = 'å·²å®Œæˆ';
            } else {
                document.getElementById('easyRecord').textContent = '--:--';
            }
            
            // å›°éš¾æ¨¡å¼
            if (records.hard) {
                const minutes = Math.floor(records.hard.timeUsed / 60);
                const seconds = records.hard.timeUsed % 60;
                document.getElementById('hardRecord').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            } else {
                document.getElementById('hardRecord').textContent = '--:--';
            }
        }

        // ==================== å…¨å±€å˜é‡ ====================
        let scene, camera, renderer, controls;
        let raycaster, mouse;
        let clock;
        let interactiveObjects = [];
        let clockHands = { hour: null, minute: null };
        let collectedItems = [];
        let isGameComplete = false;
        let pressTarget = null;
        let pressTimer = null;
        let longPressTriggered = false;
        let shortPressHandled = false;
        let clickCount = 0;
        let clickTimer = null;
        let lastClickedObject = null;

        // éšæœºå¯†ç ï¼ˆç¡®ä¿ä¸é‡å¤ï¼‰
        function generateUniquePassword(existingPasswords = []) {
            let password;
            let attempts = 0;
            do {
                password = Math.floor(1000 + Math.random() * 9000).toString();
                attempts++;
            } while (existingPasswords.includes(password) && attempts < 100);
            return password;
        }

        function initRandomPasswords() {
            const existing = [];
            drawerPassword = generateUniquePassword(existing);
            existing.push(drawerPassword);
            safePassword = generateUniquePassword(existing);
            existing.push(safePassword);
            doorPassword = generateUniquePassword(existing);
            console.log(`å¯†ç å·²ç”Ÿæˆ - æŠ½å±‰: ${drawerPassword}, ä¿é™©ç®±: ${safePassword}, é—¨: ${doorPassword}`);
        }

        // ç‰©å“æ•°æ®
        const itemData = {
            'door': {
                name: 'ğŸšª å§å®¤é—¨',
                description: 'ä¸€æ‰‡åšé‡çš„æœ¨é—¨ï¼Œä¸Šé¢æœ‰å¯†ç é”å’Œé’¥åŒ™å­”ã€‚éœ€è¦å¯†ç å’Œé’¥åŒ™æ‰èƒ½æ‰“å¼€ã€‚',
                hint: 'æ‰¾åˆ°å¯†ç å’Œé’¥åŒ™å°±èƒ½æ‰“å¼€è¿™æ‰‡é—¨...',
                canCollect: false
            },
            'window': {
                name: 'ğŸªŸ çª—æˆ·',
                description: 'ä¸€æ‰‡è¢«æœ¨æ¿å°æ­»çš„çª—æˆ·ï¼Œå¤–é¢æ˜¯æ¼†é»‘çš„å¤œæ™šã€‚æœˆå…‰é€è¿‡ç¼éš™ç…§å°„è¿›æ¥ã€‚',
                hint: 'çª—æˆ·è¢«å°æ­»äº†ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªé€ƒè„±çš„çº¿ç´¢...',
                canCollect: false
            },
            'trash': {
                name: 'ğŸ—‘ï¸ åƒåœ¾æ¡¶',
                description: 'ä¸€ä¸ªæ™®é€šçš„é‡‘å±åƒåœ¾æ¡¶ï¼Œæ¡¶å†…æœ‰æ‰çš±çš„çº¸å›¢ã€‚',
                hint: 'ä¹Ÿè®¸çº¸å›¢ä¸Šæœ‰ä»€ä¹ˆä¿¡æ¯ï¼Ÿç‚¹å‡»åƒåœ¾æ¡¶æŸ¥çœ‹ã€‚',
                canCollect: true,
                collected: false
            },
            'paper': {
                name: 'ğŸ“„ çš±çº¸å›¢',
                description: 'ä»åƒåœ¾æ¡¶é‡Œæ‰¾åˆ°çš„çº¸å›¢ï¼Œä¸Šé¢æ½¦è‰åœ°å†™ç€æ•°å­—ï¼šXXXX-XXXX-XXXX-XXXX',
                hint: 'è®°ä½è¿™ä¸ªæ•°å­—ï¼ä¹Ÿè®¸è¿™æ˜¯æŸä¸ªé”çš„å¯†ç ã€‚',
                canCollect: true,
                collected: false
            },
            'bed': {
                name: 'ğŸ›ï¸ åºŠ',
                description: 'ä¸€å¼ å‡Œä¹±çš„åºŠï¼Œæ•å¤´ä¸‹é¢å‹ç€ä¸€æœ¬æ—¥è®°ã€‚',
                hint: 'æŸ¥çœ‹æ—¥è®°ä¹Ÿè®¸èƒ½è·å¾—é‡è¦ä¿¡æ¯ã€‚',
                canCollect: false
            },
            'diary': {
                name: 'ğŸ“” æ—¥è®°æœ¬',
                description: 'æ—¥è®°çš„æœ€åä¸€é¡µå†™ç€ï¼š"è®°ä½ï¼Œå¯†ç é”çš„é¡ºåºæ˜¯åçš„..." å¯†ç ï¼šXXXX-XXXX-XXXX-XXXX',
                hint: 'å¯†ç é¡ºåºæ˜¯åçš„ï¼XXXX-XXXX-XXXX-XXXXåè¿‡æ¥å°±æ˜¯0000-0000-0000-0000',
                canCollect: true,
                collected: false
            },
            'desk': {
                name: 'ğŸª‘ ä¹¦æ¡Œ',
                description: 'ä¸€å¼ è€æ—§çš„ä¹¦æ¡Œï¼ŒæŠ½å±‰ä¼¼ä¹è¢«é”ä½äº†ã€‚',
                hint: 'æŠ½å±‰éœ€è¦é’¥åŒ™æ‰èƒ½æ‰“å¼€ã€‚',
                canCollect: false
            },
            'drawer': {
                name: 'ğŸ—ï¸ æŠ½å±‰é”',
                description: 'æŠ½å±‰ä¸Šæœ‰ä¸€ä¸ªå°é”å­”ï¼Œéœ€è¦æ‰¾åˆ°é’¥åŒ™ã€‚',
                hint: 'é’¥åŒ™å¯èƒ½è—åœ¨æˆ¿é—´çš„æŸä¸ªåœ°æ–¹ã€‚',
                canCollect: false,
                opened: false
            },
            'key': {
                name: 'ğŸ”‘ å°é’¥åŒ™',
                description: 'åœ¨èŠ±ç›†åº•éƒ¨å‘ç°çš„é“¶è‰²å°é’¥åŒ™ï¼Œçœ‹èµ·æ¥å¯ä»¥æ‰“å¼€ä»€ä¹ˆä¸œè¥¿ã€‚',
                hint: 'è¿™æŠŠé’¥åŒ™ä¹Ÿè®¸èƒ½æ‰“å¼€æŠ½å±‰ï¼',
                canCollect: true,
                collected: false
            },
            'painting': {
                name: 'ğŸ–¼ï¸ æ²¹ç”»',
                description: 'ä¸€å¹…é£æ™¯æ²¹ç”»ï¼Œç”»çš„æ˜¯æ—¥è½æ—¶çš„å±±è„‰ã€‚ç”»æ¡†ä¼¼ä¹æœ‰äº›æ¾åŠ¨ã€‚',
                hint: 'ç”»æ¡†åé¢ä¹Ÿè®¸è—ç€ä»€ä¹ˆç§˜å¯†ï¼Ÿ',
                canCollect: false
            },
            'safe': {
                name: 'ğŸ”’ ä¿é™©ç®±',
                description: 'å¢™ä¸Šçš„ä¿é™©ç®±ï¼Œéœ€è¦è¾“å…¥4ä½å¯†ç æ‰èƒ½æ‰“å¼€ã€‚',
                hint: 'è¾“å…¥æ­£ç¡®çš„å¯†ç è¯•è¯•çœ‹ï¼',
                canCollect: false,
                opened: false
            },
            'plant': {
                name: 'ğŸª´ ç›†æ ½',
                description: 'ä¸€ç›†æ¯èçš„ç»¿æ¤ï¼ŒèŠ±ç›†é‡Œçš„åœŸçœ‹èµ·æ¥è¢«äººç¿»åŠ¨è¿‡ã€‚',
                hint: 'æ£€æŸ¥èŠ±ç›†é‡Œçš„åœŸå£¤ã€‚',
                canCollect: true,
                collected: false
            },
            'safe_content': {
                name: 'ğŸ”‘ é—¨é’¥åŒ™',
                description: 'ä¿é™©ç®±é‡Œçš„é‡‘è‰²é’¥åŒ™ï¼è¿™ä¸€å®šæ˜¯æ‰“å¼€æˆ¿é—¨çš„é’¥åŒ™ï¼',
                hint: 'å¸¦ç€è¿™æŠŠé’¥åŒ™å»å¼€é—¨å§ï¼',
                canCollect: true,
                collected: false
            },
            'clock': {
                name: 'ğŸ• æŒ‚é’Ÿ',
                description: 'ä¸€ä¸ªåœæ­¢çš„æŒ‚é’Ÿï¼ŒæŒ‡é’ˆåœåœ¨7ç‚¹20åˆ†ã€‚',
                hint: '7:20...è¿™ä¸ªæ—¶é—´æœ‰ä»€ä¹ˆç‰¹æ®Šå«ä¹‰å—ï¼Ÿ',
                canCollect: false
            },
            'lamp': {
                name: 'ğŸ’¡ å°ç¯',
                description: 'ä¸€ç›è€å¼å°ç¯ï¼Œç¯ç½©ä¸Šç§¯æ»¡äº†ç°å°˜ã€‚',
                hint: 'ç°å°˜é‡Œä¹Ÿè®¸èƒ½æå–åˆ°æŒ‡çº¹...',
                canCollect: false
            }
        };

        // ==================== åˆå§‹åŒ– ====================
        function init() {
            // åˆå§‹åŒ–éŸ³æ•ˆç³»ç»Ÿ
            soundManager.init();

            // åˆå§‹åŒ–éšæœºå¯†ç 
            initRandomPasswords();
            itemData['safe'].hint = `è¾“å…¥å¯†ç  ${safePassword.slice(0,1)}-${safePassword.slice(1,2)}-${safePassword.slice(2,3)}-${safePassword.slice(3,4)} è¯•è¯•çœ‹ï¼`;

            // åˆ›å»ºåœºæ™¯
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a0a);
            scene.fog = new THREE.Fog(0x0a0a0a, 5, 25);

            // åˆ›å»ºç›¸æœº
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(4, 3, 5);

            // åˆ›å»ºæ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ 
                antialias: true,
                powerPreference: "high-performance"
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.2;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // åˆ›å»ºæ§åˆ¶å™¨
            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 2;
            controls.maxDistance = 15;
            controls.maxPolarAngle = Math.PI * 0.85;
            controls.target.set(0, 1.5, 0);

            // åˆå§‹åŒ–å°„çº¿æ£€æµ‹
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            clock = new THREE.Clock();

            // æ·»åŠ åœºæ™¯å†…å®¹
            addLighting();
            createRoom();
            createFurniture();
            addInteractiveObjects();

            // æ›´æ–°ç‰©ä½“æ•°é‡
            document.getElementById('objectsCount').textContent = interactiveObjects.length;

            // äº‹ä»¶ç›‘å¬
            window.addEventListener('resize', onWindowResize);
            renderer.domElement.addEventListener('click', onMouseClick);
            renderer.domElement.addEventListener('mousemove', onMouseMove);

            // UIäº‹ä»¶
            document.getElementById('closeModal').addEventListener('click', closeModal);
            document.getElementById('closeInventory').addEventListener('click', toggleInventory);
            document.getElementById('closePassword').addEventListener('click', closePasswordModal);
            document.getElementById('inventoryBtn').addEventListener('click', toggleInventory);
            document.getElementById('resetViewBtn').addEventListener('click', resetView);
            
            // éš¾åº¦é€‰æ‹©æŒ‰é’®
            document.getElementById('easyBtn').addEventListener('click', () => {
                soundManager.playClickSound();
                startGame('easy');
            });
            
            document.getElementById('hardBtn').addEventListener('click', () => {
                soundManager.playClickSound();
                startGame('hard');
            });
            
            // å†è¯•ä¸€æ¬¡æŒ‰é’®
            document.getElementById('retryBtn').addEventListener('click', () => {
                soundManager.playClickSound();
                restartGame();
            });
            
            // é‡æ–°å¼€å§‹æŒ‰é’®ï¼ˆä»æˆåŠŸç•Œé¢ï¼‰
            document.getElementById('restartBtn').addEventListener('click', () => {
                soundManager.playClickSound();
                restartGame();
            });
            
            // åŠ è½½æœ€ä½³çºªå½•
            loadBestRecords();
            
            // é™éŸ³æŒ‰é’®
            document.getElementById('muteBtn').addEventListener('click', (e) => {
                e.stopPropagation();
                const isMuted = soundManager.toggleMute();
                document.getElementById('muteBtn').textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
                soundManager.playClickSound();
            });

            // ç”¨æˆ·äº¤äº’æ£€æµ‹ï¼ˆç”¨äºiOS SafariéŸ³é¢‘æ’­æ”¾ï¼‰
            const handleUserInteraction = () => {
                if (!soundManager.userHasInteracted) {
                    soundManager.userHasInteracted = true;
                    soundManager.init();
                    document.getElementById('soundPrompt').classList.remove('visible');
                }
            };
            
            document.addEventListener('click', handleUserInteraction, { once: true });
            document.addEventListener('touchstart', handleUserInteraction, { once: true });

            // é¦–æ¬¡è¿›å…¥æç¤º
            setTimeout(() => {
                if (!soundManager.userHasInteracted) {
                    document.getElementById('soundPrompt').classList.add('visible');
                }
            }, 2000);

            // å¯†ç é”®ç›˜äº‹ä»¶
            document.querySelectorAll('.key-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const digit = btn.dataset.digit;
                    
                    if (digit === 'clear') {
                        soundManager.playDeleteSound();
                        soundManager.vibrateKey();
                    } else if (digit === 'enter') {
                        soundManager.playKeySound();
                        soundManager.vibrateKey();
                    } else {
                        soundManager.playKeySound();
                        soundManager.vibrateKey();
                    }
                    
                    handlePasswordDigit(digit);
                });
            });

            // æ¨¡æ‹ŸåŠ è½½è¿›åº¦
            simulateLoading();

            // å¼€å§‹åŠ¨ç”»å¾ªç¯
            animate();
        }

        // ==================== åŠ è½½è¿›åº¦æ¨¡æ‹Ÿ ====================
        function simulateLoading() {
            const loadingBar = document.getElementById('loadingBar');
            const loadingText = document.getElementById('loadingText');
            const loadingScreen = document.getElementById('loadingScreen');
            const stages = [
                { progress: 20, text: 'æ„å»ºå¯†å®¤ç»“æ„...' },
                { progress: 40, text: 'æ·»åŠ å®¶å…·æ¨¡å‹...' },
                { progress: 60, text: 'è®¾ç½®å…‰ç…§æ•ˆæœ...' },
                { progress: 80, text: 'é…ç½®äº¤äº’ç³»ç»Ÿ...' },
                { progress: 100, text: 'å‡†å¤‡å®Œæˆï¼' }
            ];

            let currentStage = 0;
            const interval = setInterval(() => {
                if (currentStage < stages.length) {
                    loadingBar.style.width = stages[currentStage].progress + '%';
                    loadingText.textContent = stages[currentStage].text;
                    currentStage++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                    }, 500);
                }
            }, 400);
        }

        // ==================== å…‰ç…§ç³»ç»Ÿ ====================
        function addLighting() {
            // ç¯å¢ƒå…‰
            const ambientLight = new THREE.AmbientLight(0x404050, 0.4);
            scene.add(ambientLight);

            // ä¸»å…‰æºï¼ˆæ¨¡æ‹ŸåŠç¯ï¼‰
            const mainLight = new THREE.PointLight(0xffeedd, 1.5, 20);
            mainLight.position.set(0, 3.5, 0);
            mainLight.castShadow = true;
            mainLight.shadow.mapSize.width = 2048;
            mainLight.shadow.mapSize.height = 2048;
            mainLight.shadow.camera.near = 0.5;
            mainLight.shadow.camera.far = 15;
            scene.add(mainLight);

            // è¾…åŠ©å…‰æºï¼ˆå°ç¯ï¼‰
            const deskLight = new THREE.PointLight(0xffaa66, 0.8, 8);
            deskLight.position.set(-2, 1.8, -1.5);
            scene.add(deskLight);

            // çª—æˆ·æœˆå…‰æ•ˆæœ
            const moonLight = new THREE.DirectionalLight(0x6688ff, 0.3);
            moonLight.position.set(5, 3, 0);
            scene.add(moonLight);

            // é—¨ç¼é€å…‰
            const doorLight = new THREE.PointLight(0xffeedd, 0.5, 3);
            doorLight.position.set(2.55, 1.5, 0);
            scene.add(doorLight);
        }

        // ==================== åˆ›å»ºæˆ¿é—´ ====================
        function createRoom() {
            // åœ°æ¿
            const floorGeometry = new THREE.PlaneGeometry(6, 6);
            const floorMaterial = new THREE.MeshStandardMaterial({
                color: 0x3a3a3a,
                roughness: 0.8,
                metalness: 0.2
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // æ·»åŠ åœ°æ¿çº¹ç†çº¿æ¡
            const lineGeometry = new THREE.EdgesGeometry(new THREE.PlaneGeometry(6, 6));
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0x555555 });
            const floorLines = new THREE.LineSegments(lineGeometry, lineMaterial);
            floorLines.rotation.x = -Math.PI / 2;
            floorLines.position.y = 0.001;
            scene.add(floorLines);

            // å¤©èŠ±æ¿
            const ceilingGeometry = new THREE.PlaneGeometry(6, 6);
            const ceilingMaterial = new THREE.MeshStandardMaterial({
                color: 0x2a2a2a,
                roughness: 0.9,
                metalness: 0.1
            });
            const ceiling = new THREE.Mesh(ceilingGeometry, ceilingMaterial);
            ceiling.rotation.x = Math.PI / 2;
            ceiling.position.y = 4;
            scene.add(ceiling);

            // å¢™å£æè´¨
            const wallMaterial = new THREE.MeshStandardMaterial({
                color: 0xd4c4b0,
                roughness: 0.85,
                metalness: 0.1
            });

            // åå¢™
            const backWall = new THREE.Mesh(new THREE.PlaneGeometry(6, 4), wallMaterial);
            backWall.position.set(0, 2, -3);
            backWall.receiveShadow = true;
            scene.add(backWall);

            // é—¨æ´ï¼ˆåå¢™ä¸­å¤®ï¼‰
            const doorFrameMaterial = new THREE.MeshStandardMaterial({
                color: 0x4a3728,
                roughness: 0.7,
                metalness: 0.2
            });

            const doorFrame = new THREE.Mesh(
                new THREE.BoxGeometry(1.3, 2.5, 0.15),
                doorFrameMaterial
            );
            doorFrame.position.set(0, 1.25, -2.95);
            doorFrame.castShadow = true;
            scene.add(doorFrame);

            // é—¨æ¿
            const door = new THREE.Mesh(
                new THREE.BoxGeometry(1.1, 2.4, 0.08),
                new THREE.MeshStandardMaterial({ color: 0x5c4033, roughness: 0.6 })
            );
            door.position.set(0, 1.2, -2.9);
            door.castShadow = true;
            door.name = 'door';
            scene.add(door);
            interactiveObjects.push(door);

            // é—¨æŠŠæ‰‹
            const doorHandle = new THREE.Mesh(
                new THREE.SphereGeometry(0.05),
                new THREE.MeshStandardMaterial({ color: 0xc4a747, metalness: 0.8, roughness: 0.3 })
            );
            doorHandle.position.set(0.45, 1.2, -2.85);
            scene.add(doorHandle);

            // é—¨é”æç¤º
            const doorLock = new THREE.Mesh(
                new THREE.CylinderGeometry(0.03, 0.03, 0.02),
                new THREE.MeshStandardMaterial({ color: 0x333333, metalness: 0.8 })
            );
            doorLock.rotation.x = Math.PI / 2;
            doorLock.position.set(0, 1.5, -2.86);
            scene.add(doorLock);

            // å‰å¢™
            const frontWall = new THREE.Mesh(new THREE.PlaneGeometry(6, 4), wallMaterial);
            frontWall.position.set(0, 2, 3);
            frontWall.rotation.y = Math.PI;
            scene.add(frontWall);

            // å·¦å¢™
            const leftWall = new THREE.Mesh(new THREE.PlaneGeometry(6, 4), wallMaterial);
            leftWall.position.set(-3, 2, 0);
            leftWall.rotation.y = Math.PI / 2;
            leftWall.receiveShadow = true;
            scene.add(leftWall);

            // å³å¢™
            const rightWall = new THREE.Mesh(new THREE.PlaneGeometry(6, 4), wallMaterial);
            rightWall.position.set(3, 2, 0);
            rightWall.rotation.y = -Math.PI / 2;
            scene.add(rightWall);
        }

        // ==================== åˆ›å»ºå®¶å…· ====================
        function createFurniture() {
            // åºŠ
            createBed();

            // ä¹¦æ¡Œ
            createDesk();

            // ä¿é™©ç®±
            createSafe();

            // è¡£æŸœ
            createWardrobe();

            // ç›†æ ½
            createPlant();

            // æŒ‚é’Ÿ
            createClock();

            // åƒåœ¾æ¡¶
            createTrash();

            // æ²¹ç”»
            createPainting();

            // åœ°æ¯¯ (å›°éš¾æ¨¡å¼)
            createCarpet();

            // ä¿¡å° (å›°éš¾æ¨¡å¼)
            createEnvelope();
        }

        function createCarpet() {
            const carpetGeometry = new THREE.PlaneGeometry(2, 3);
            const carpetMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x8b0000, // æ·±çº¢è‰²
                roughness: 1.0,
                side: THREE.DoubleSide
            });
            const carpet = new THREE.Mesh(carpetGeometry, carpetMaterial);
            carpet.rotation.x = -Math.PI / 2;
            carpet.position.set(-1.5, 0.02, 1); // æ”¾åœ¨å·¦ä¸‹åŒºåŸŸ
            carpet.receiveShadow = true;
            carpet.name = 'carpet';
            scene.add(carpet);
            interactiveObjects.push(carpet);
        }

        function createEnvelope() {
            const envelopeGroup = new THREE.Group();
            
            // ä¿¡å°ä¸»ä½“
            const body = new THREE.Mesh(
                new THREE.PlaneGeometry(0.4, 0.3),
                new THREE.MeshStandardMaterial({ color: 0xfffdd0, side: THREE.DoubleSide })
            );
            body.rotation.x = -Math.PI / 2;
            envelopeGroup.add(body);
            
            // å°å£æŠ˜ç—•
            const flap = new THREE.Mesh(
                new THREE.ConeGeometry(0.28, 0.15, 3), // ä¸‰è§’å½¢
                new THREE.MeshStandardMaterial({ color: 0xebebb5 })
            );
            flap.rotation.x = Math.PI / 2;
            flap.rotation.z = Math.PI;
            flap.scale.z = 0.01;
            flap.position.set(0, 0.001, -0.07);
            envelopeGroup.add(flap);
            
            envelopeGroup.position.set(0, 0.02, 0); // æˆ¿é—´ä¸­é—´
            envelopeGroup.name = 'envelope';
            scene.add(envelopeGroup);
            interactiveObjects.push(envelopeGroup);
        }

        function createBed() {
            const bedGroup = new THREE.Group();

            // åºŠæ¶
            const bedFrame = new THREE.Mesh(
                new THREE.BoxGeometry(2, 0.5, 2.5),
                new THREE.MeshStandardMaterial({ color: 0x4a3728, roughness: 0.7 })
            );
            bedFrame.position.y = 0.25;
            bedFrame.castShadow = true;
            bedGroup.add(bedFrame);

            // åºŠå«
            const mattress = new THREE.Mesh(
                new THREE.BoxGeometry(1.9, 0.3, 2.4),
                new THREE.MeshStandardMaterial({ color: 0xf5f5dc, roughness: 0.9 })
            );
            mattress.position.y = 0.65;
            mattress.castShadow = true;
            bedGroup.add(mattress);

            // æ•å¤´
            const pillow = new THREE.Mesh(
                new THREE.BoxGeometry(0.5, 0.15, 0.35),
                new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.8 })
            );
            pillow.position.set(0.5, 0.95, 1);
            pillow.name = 'bed';
            bedGroup.add(pillow);
            interactiveObjects.push(pillow);

            // è¢«å­
            const blanket = new THREE.Mesh(
                new THREE.BoxGeometry(1.8, 0.2, 1.5),
                new THREE.MeshStandardMaterial({ color: 0x8b4513, roughness: 0.8 })
            );
            blanket.position.set(-0.1, 0.9, 0);
            blanket.castShadow = true;
            bedGroup.add(blanket);

            bedGroup.position.set(2, 0, -2);
            scene.add(bedGroup);
        }

        function createDesk() {
            const deskGroup = new THREE.Group();

            // æ¡Œé¢
            const desktop = new THREE.Mesh(
                new THREE.BoxGeometry(1.5, 0.08, 0.8),
                new THREE.MeshStandardMaterial({ color: 0x5c4033, roughness: 0.6 })
            );
            desktop.position.y = 0.8;
            desktop.castShadow = true;
            deskGroup.add(desktop);

            // æ¡Œè…¿
            const legMaterial = new THREE.MeshStandardMaterial({ color: 0x4a3728 });
            const legGeometry = new THREE.BoxGeometry(0.08, 0.8, 0.08);
            
            const leg1 = new THREE.Mesh(legGeometry, legMaterial);
            leg1.position.set(-0.65, 0.4, 0.3);
            deskGroup.add(leg1);

            const leg2 = new THREE.Mesh(legGeometry, legMaterial);
            leg2.position.set(0.65, 0.4, 0.3);
            deskGroup.add(leg2);

            const leg3 = new THREE.Mesh(legGeometry, legMaterial);
            leg3.position.set(-0.65, 0.4, -0.3);
            deskGroup.add(leg3);

            const leg4 = new THREE.Mesh(legGeometry, legMaterial);
            leg4.position.set(0.65, 0.4, -0.3);
            deskGroup.add(leg4);

            // æŠ½å±‰
            const drawer = new THREE.Mesh(
                new THREE.BoxGeometry(0.5, 0.4, 0.5),
                new THREE.MeshStandardMaterial({ color: 0x5c4033, roughness: 0.6 })
            );
            drawer.position.set(-0.4, 0.38, 0);
            drawer.name = 'drawer';
            deskGroup.add(drawer);
            interactiveObjects.push(drawer);

            // æŠ½å±‰æŠŠæ‰‹
            const drawerHandle = new THREE.Mesh(
                new THREE.CylinderGeometry(0.03, 0.03, 0.1),
                new THREE.MeshStandardMaterial({ color: 0xc4a747, metalness: 0.8 })
            );
            drawerHandle.rotation.z = Math.PI / 2;
            drawerHandle.position.set(-0.4, 0.38, 0.28);
            deskGroup.add(drawerHandle);

            // å°ç¯
            const lampGroup = new THREE.Group();
            const lampBase = new THREE.Mesh(
                new THREE.CylinderGeometry(0.1, 0.12, 0.05),
                new THREE.MeshStandardMaterial({ color: 0x333333, metalness: 0.8 })
            );
            lampBase.position.y = 0.85;
            lampGroup.add(lampBase);

            const lampPole = new THREE.Mesh(
                new THREE.CylinderGeometry(0.02, 0.02, 0.4),
                new THREE.MeshStandardMaterial({ color: 0x444444, metalness: 0.6 })
            );
            lampPole.position.y = 1.1;
            lampGroup.add(lampPole);

            const lampShade = new THREE.Mesh(
                new THREE.ConeGeometry(0.15, 0.2, 8, 1, true),
                new THREE.MeshStandardMaterial({ 
                    color: 0xf5deb3, 
                    roughness: 0.8,
                    side: THREE.DoubleSide
                })
            );
            lampShade.position.y = 1.35;
            lampGroup.add(lampShade);
            lampShade.name = 'lamp';
            interactiveObjects.push(lampShade);

            // ç¯æ³¡å…‰æ™•
            const bulbGlow = new THREE.PointLight(0xffaa66, 0.5, 2);
            bulbGlow.position.y = 1.3;
            lampGroup.add(bulbGlow);

            lampGroup.position.set(0.4, 0, 0);
            deskGroup.add(lampGroup);

            // æ—¥è®°æœ¬
            const diary = new THREE.Mesh(
                new THREE.BoxGeometry(0.2, 0.03, 0.25),
                new THREE.MeshStandardMaterial({ color: 0x8b0000, roughness: 0.7 })
            );
            diary.position.set(-0.3, 0.86, -0.2);
            diary.rotation.y = 0.2;
            diary.name = 'diary';
            deskGroup.add(diary);
            interactiveObjects.push(diary);

            deskGroup.position.set(-2, 0, 2);
            scene.add(deskGroup);
        }

        function createSafe() {
            const safeGroup = new THREE.Group();

            // ä¿é™©ç®±ä¸»ä½“
            const safeBody = new THREE.Mesh(
                new THREE.BoxGeometry(0.5, 0.5, 0.3),
                new THREE.MeshStandardMaterial({ 
                    color: 0x2a2a2a, 
                    metalness: 0.9, 
                    roughness: 0.3 
                })
            );
            safeBody.castShadow = true;
            safeGroup.add(safeBody);

            // å¯†ç é¢æ¿
            const keypad = new THREE.Mesh(
                new THREE.PlaneGeometry(0.3, 0.25),
                new THREE.MeshStandardMaterial({ color: 0x1a1a1a })
            );
            keypad.position.z = 0.16;
            keypad.name = 'safe';
            safeGroup.add(keypad);
            interactiveObjects.push(keypad);

            // å¯†ç æ•°å­—
            for (let i = 0; i < 4; i++) {
                const digit = new THREE.Mesh(
                    new THREE.PlaneGeometry(0.05, 0.08),
                    new THREE.MeshBasicMaterial({ color: 0x00ff00 })
                );
                digit.position.set(-0.1 + i * 0.07, 0.05, 0.17);
                safeGroup.add(digit);
            }

            // æ—‹è½¬æŠŠæ‰‹
            const handle = new THREE.Mesh(
                new THREE.TorusGeometry(0.08, 0.02, 8, 16),
                new THREE.MeshStandardMaterial({ color: 0xc4a747, metalness: 0.8 })
            );
            handle.position.set(0.15, 0, 0.15);
            handle.rotation.y = Math.PI / 2;
            safeGroup.add(handle);

            safeGroup.position.set(2.8, 1.5, 1.5);
            safeGroup.rotation.y = -Math.PI / 2;
            scene.add(safeGroup);
        }

        function createWardrobe() {
            const wardrobeGroup = new THREE.Group();

            // è¡£æŸœä¸»ä½“
            const wardrobe = new THREE.Mesh(
                new THREE.BoxGeometry(1.5, 2.5, 0.6),
                new THREE.MeshStandardMaterial({ color: 0x5c4033, roughness: 0.7 })
            );
            wardrobe.position.y = 1.25;
            wardrobe.castShadow = true;
            wardrobe.name = 'wardrobe';
            wardrobeGroup.add(wardrobe);
            interactiveObjects.push(wardrobe);

            // é—¨ç¼çº¿æ¡
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0x3a2819 });
            const edges = new THREE.EdgesGeometry(new THREE.BoxGeometry(1.5, 2.5, 0.6));
            const lines = new THREE.LineSegments(edges, lineMaterial);
            lines.position.y = 1.25;
            wardrobeGroup.add(lines);

            // é—¨æŠŠæ‰‹
            const handle = new THREE.Mesh(
                new THREE.CylinderGeometry(0.03, 0.03, 0.15),
                new THREE.MeshStandardMaterial({ color: 0xc4a747, metalness: 0.8 })
            );
            handle.rotation.z = Math.PI / 2;
            handle.position.set(0.6, 1.25, 0.35);
            wardrobeGroup.add(handle);

            wardrobeGroup.position.set(-2.7, 0, -2.7);
            scene.add(wardrobeGroup);
        }

        function createPlant() {
            const plantGroup = new THREE.Group();

            // èŠ±ç›†
            const pot = new THREE.Mesh(
                new THREE.CylinderGeometry(0.2, 0.15, 0.3, 16),
                new THREE.MeshStandardMaterial({ color: 0x8b4513, roughness: 0.8 })
            );
            pot.position.y = 0.15;
            pot.castShadow = true;
            pot.name = 'plant';
            plantGroup.add(pot);
            interactiveObjects.push(pot);

            // åœŸå£¤
            const soil = new THREE.Mesh(
                new THREE.CylinderGeometry(0.18, 0.18, 0.02, 16),
                new THREE.MeshStandardMaterial({ color: 0x3d2914, roughness: 1 })
            );
            soil.position.y = 0.29;
            soil.name = 'plant';
            plantGroup.add(soil);
            interactiveObjects.push(soil);

            // èŒ
            const stemMaterial = new THREE.MeshStandardMaterial({ color: 0x228b22 });
            for (let i = 0; i < 5; i++) {
                const stem = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.01, 0.01, 0.3, 8),
                    stemMaterial
                );
                const angle = (i / 5) * Math.PI * 2;
                stem.position.set(
                    Math.cos(angle) * 0.08,
                    0.5,
                    Math.sin(angle) * 0.08
                );
                stem.rotation.x = Math.random() * 0.3 - 0.15;
                stem.rotation.z = Math.random() * 0.3 - 0.15;
                stem.name = 'plant';
                plantGroup.add(stem);
                interactiveObjects.push(stem);

                // å¶å­
                const leaf = new THREE.Mesh(
                    new THREE.SphereGeometry(0.08, 8, 8),
                    new THREE.MeshStandardMaterial({ color: 0x32cd32, roughness: 0.8 })
                );
                leaf.position.set(
                    Math.cos(angle) * 0.08 + Math.cos(angle) * 0.2,
                    0.7,
                    Math.sin(angle) * 0.08 + Math.sin(angle) * 0.2
                );
                leaf.scale.y = 0.5;
                leaf.name = 'plant';
                plantGroup.add(leaf);
                interactiveObjects.push(leaf);
            }

            // é’¥åŒ™ï¼ˆåœ¨åœŸå£¤é‡Œï¼‰
            const key = new THREE.Mesh(
                new THREE.BoxGeometry(0.05, 0.02, 0.08),
                new THREE.MeshStandardMaterial({ color: 0xc4a747, metalness: 0.9 })
            );
            key.position.set(0.05, 0.31, 0);
            key.rotation.y = Math.PI / 4;
            key.name = 'key';
            key.visible = false;
            plantGroup.add(key);
            interactiveObjects.push(key);

            plantGroup.position.set(2.3, 0, 2.3);
            scene.add(plantGroup);
        }

        function createClock() {
            const clockGroup = new THREE.Group();

            // æ—¶é’Ÿå¤–å£³
            const clockCase = new THREE.Mesh(
                new THREE.CylinderGeometry(0.25, 0.25, 0.05, 32),
                new THREE.MeshStandardMaterial({ color: 0x4a3728, roughness: 0.6 })
            );
            clockCase.rotation.x = Math.PI / 2;
            clockGroup.add(clockCase);

            // æ—¶é’Ÿè¡¨é¢
            const clockFace = new THREE.Mesh(
                new THREE.CircleGeometry(0.22, 32),
                new THREE.MeshStandardMaterial({ color: 0xfffff0 })
            );
            clockFace.position.z = 0.03;
            clockGroup.add(clockFace);

            // æ—¶é’ˆ
            const hourHand = new THREE.Mesh(
                new THREE.BoxGeometry(0.02, 0.12, 0.01),
                new THREE.MeshStandardMaterial({ color: 0x000000 })
            );
            hourHand.position.z = 0.04;
            hourHand.position.y = 0.05;
            hourHand.name = 'clock';
            clockGroup.add(hourHand);
            clockHands.hour = hourHand;
            interactiveObjects.push(hourHand);

            // åˆ†é’ˆ
            const minuteHand = new THREE.Mesh(
                new THREE.BoxGeometry(0.015, 0.16, 0.01),
                new THREE.MeshStandardMaterial({ color: 0x000000 })
            );
            minuteHand.position.z = 0.04;
            minuteHand.position.y = 0.06;
            clockGroup.add(minuteHand);
            clockHands.minute = minuteHand;

            // ä¸­å¿ƒç‚¹
            const centerPin = new THREE.Mesh(
                new THREE.CylinderGeometry(0.02, 0.02, 0.02, 16),
                new THREE.MeshStandardMaterial({ color: 0xc4a747, metalness: 0.8 })
            );
            centerPin.rotation.x = Math.PI / 2;
            centerPin.position.z = 0.04;
            clockGroup.add(centerPin);

            clockGroup.position.set(-1.2, 2.8, -2.95);
            clockGroup.rotation.y = 0;
            scene.add(clockGroup);
        }

        function createTrash() {
            const trashGroup = new THREE.Group();

            // æ¡¶èº«
            const trashBody = new THREE.Mesh(
                new THREE.CylinderGeometry(0.15, 0.12, 0.35, 16),
                new THREE.MeshStandardMaterial({ color: 0x4a6fa5, roughness: 0.5, metalness: 0.3 })
            );
            trashBody.position.y = 0.175;
            trashBody.castShadow = true;
            trashBody.name = 'trash';
            trashGroup.add(trashBody);
            interactiveObjects.push(trashBody);

            // çº¸å›¢
            const paper = new THREE.Mesh(
                new THREE.SphereGeometry(0.06, 8, 8),
                new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.9 })
            );
            paper.position.set(0.05, 0.35, 0.03);
            paper.scale.set(1, 0.8, 0.7);
            paper.name = 'paper';
            trashGroup.add(paper);
            interactiveObjects.push(paper);

            trashGroup.position.set(0.8, 0, 0.5); // é—¨å³ä¾§æ˜¾çœ¼ä½ç½®
            scene.add(trashGroup);
        }

        function createPainting() {
            const paintingGroup = new THREE.Group();

            // ç”»æ¡†
            const frame = new THREE.Mesh(
                new THREE.BoxGeometry(0.8, 0.6, 0.05),
                new THREE.MeshStandardMaterial({ color: 0x8b7355, roughness: 0.6 })
            );
            frame.castShadow = true;
            paintingGroup.add(frame);

            // ç”»å¸ƒ
            const canvas = new THREE.Mesh(
                new THREE.PlaneGeometry(0.7, 0.5),
                new THREE.MeshStandardMaterial({ color: 0xffa07a })
            );
            canvas.position.z = 0.03;
            paintingGroup.add(canvas);

            // é£æ™¯ç”»ï¼ˆç®€åŒ–ï¼‰
            const sky = new THREE.Mesh(
                new THREE.PlaneGeometry(0.65, 0.3),
                new THREE.MeshBasicMaterial({ color: 0xffcc99 })
            );
            sky.position.set(0, 0.1, 0.04);
            paintingGroup.add(sky);

            const mountain = new THREE.Mesh(
                new THREE.PlaneGeometry(0.6, 0.2),
                new THREE.MeshBasicMaterial({ color: 0x8b4513 })
            );
            mountain.position.set(0, -0.05, 0.041);
            paintingGroup.add(mountain);

            const sun = new THREE.Mesh(
                new THREE.CircleGeometry(0.08, 16),
                new THREE.MeshBasicMaterial({ color: 0xffff00 })
            );
            sun.position.set(0.2, 0.15, 0.041);
            paintingGroup.add(sun);

            paintingGroup.position.set(-2.9, 2.2, 1);
            paintingGroup.rotation.y = Math.PI / 2;
            paintingGroup.name = 'painting';
            scene.add(paintingGroup);
            interactiveObjects.push(paintingGroup);
        }

        // ==================== æ·»åŠ äº¤äº’å¯¹è±¡ ====================
        function addInteractiveObjects() {
            // æ‰€æœ‰å¯äº¤äº’å¯¹è±¡å·²æ·»åŠ åˆ°interactiveObjectsæ•°ç»„
        }

        // ==================== äº‹ä»¶å¤„ç† ====================
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onMouseMove(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            // å°„çº¿æ£€æµ‹æ‚¬åœæ•ˆæœ
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactiveObjects);

            if (intersects.length > 0) {
                document.body.style.cursor = 'pointer';
                const hint = document.getElementById('actionHint');
                const objectName = intersects[0].object.name;
                if (objectName && itemData[objectName]) {
                    hint.textContent = `ç‚¹å‡»æŸ¥çœ‹: ${itemData[objectName].name}`;
                    hint.classList.add('visible');
                }
            } else {
                document.body.style.cursor = 'default';
                document.getElementById('actionHint').classList.remove('visible');
            }
        }

        function onPressStart(event) {
            if (currentDifficulty !== 'hard' || isGameComplete) return;
            let clientX = event.clientX;
            let clientY = event.clientY;
            if (event.touches && event.touches[0]) {
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            }
            mouse.x = (clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactiveObjects);
            if (intersects.length === 0) return;
            pressTarget = intersects[0].object.name;
            longPressTriggered = false;
            const threshold = pressTarget === 'painting' ? 3000 : (pressTarget === 'carpet' ? 2000 : 1500);
            clearTimeout(pressTimer);
            pressTimer = setTimeout(() => {
                longPressTriggered = true;
                handleHardModeInteraction(pressTarget, true);
            }, threshold);
        }

        function onPressEnd(event) {
            if (currentDifficulty !== 'hard' || isGameComplete) return;
            clearTimeout(pressTimer);

            if (longPressTriggered) {
                pressTarget = null;
                longPressTriggered = false;
                return;
            }

            let clientX = event.clientX || (event.changedTouches && event.changedTouches[0].clientX);
            let clientY = event.clientY || (event.changedTouches && event.changedTouches[0].clientY);
            if (clientX === undefined || clientY === undefined) {
                if (!pressTarget) return;
                clientX = window.innerWidth / 2;
                clientY = window.innerHeight / 2;
            }

            mouse.x = (clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(clientY / window.innerHeight) * 2 + 1;
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactiveObjects);

            if (intersects.length > 0 && pressTarget === intersects[0].object.name) {
                shortPressHandled = true;
                handleHardModeInteraction(pressTarget, false);
            }

            pressTarget = null;
            longPressTriggered = false;
        }

        function onMouseClick(event) {
            if (isGameComplete) return;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(interactiveObjects, true);

            if (intersects.length > 0) {
                let object = intersects[0].object;
                while (object.parent && !object.name && object.parent !== scene) {
                    object = object.parent;
                }
                const objectName = object.name || '';

                // æ’­æ”¾ç‰©å“ç‚¹å‡»éŸ³æ•ˆ
                soundManager.playClickSound();
                soundManager.vibrateKey();

                if (currentDifficulty === 'hard') {
                    const multiClickObjects = ['painting', 'carpet'];
                    if (multiClickObjects.includes(objectName)) {
                        if (lastClickedObject === objectName) {
                            clickCount++;
                        } else {
                            clickCount = 1;
                            lastClickedObject = objectName;
                        }
                        clearTimeout(clickTimer);
                        const requiredClicks = 2; // ç”»æ¡†å’Œåœ°æ¯¯éƒ½ç»Ÿä¸€ä¸ºåŒå‡»è§¦å‘é«˜çº§çº¿ç´¢
                        clickTimer = setTimeout(() => {
                            clickCount = 0;
                            lastClickedObject = null;
                        }, 1500);
                        if (clickCount >= requiredClicks) {
                            handleHardModeInteraction(objectName, true);
                            clickCount = 0;
                            lastClickedObject = null;
                            return;
                        }
                    }
                    if (shortPressHandled) {
                        shortPressHandled = false;
                        return;
                    }
                    handleHardModeInteraction(objectName, false);
                    return;
                }

                // å¤„ç†ç‰¹æ®Šç‰©å“çš„äº¤äº’é€»è¾‘
                if (objectName === 'plant') {
                    // ç‚¹å‡»ç›†æ ½ï¼Œè·å¾—å°é’¥åŒ™
                    const plantData = itemData['plant'];
                    if (!plantData.collected) {
                        plantData.collected = true;
                        // æ·»åŠ é’¥åŒ™åˆ°èƒŒåŒ…
                        const keyItem = itemData['key'];
                        if (keyItem) {
                            keyItem.collected = true;
                            collectedItems.push('key');
                            showModal('ğŸ”‘ å‘ç°é’¥åŒ™ï¼', 
                                'ä½ åœ¨èŠ±ç›†çš„åœŸå£¤é‡Œå‘ç°äº†ä¸€æŠŠé“¶è‰²çš„å°é’¥åŒ™ï¼è¿™æŠŠé’¥åŒ™çœ‹èµ·æ¥å¯ä»¥æ‰“å¼€ä»€ä¹ˆä¸œè¥¿...', 
                                'å»ä¹¦æ¡ŒæŠ½å±‰è¯•è¯•çœ‹ï¼Ÿ');
                            updateInventory();
                        }
                    } else {
                        showModal(plantData.name, plantData.description, 'ç›†æ ½é‡Œå·²ç»æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿äº†ã€‚');
                    }
                    return;
                }

                // å¤„ç†æŠ½å±‰çš„äº¤äº’é€»è¾‘
                if (objectName === 'drawer') {
                    const drawerData = itemData['drawer'];
                    if (drawerData.opened) {
                        showModal(drawerData.name, 'æŠ½å±‰å·²ç»æ‰“å¼€äº†ï¼Œé‡Œé¢ç©ºç©ºå¦‚ä¹Ÿã€‚', '');
                    } else if (collectedItems.includes('key')) {
                        drawerData.opened = true;
                        showModal('ğŸ”“ æŠ½å±‰å·²æ‰“å¼€ï¼', 
                            `ä½ ç”¨å°é’¥åŒ™æ‰“å¼€äº†æŠ½å±‰ï¼åœ¨æŠ½å±‰é‡Œå‘ç°äº†ä¸€å¼ çº¸æ¡ï¼Œä¸Šé¢å†™ç€ä¸€ä¸²æ•°å­—ï¼š<strong>${safePassword.slice(0,1)}-${safePassword.slice(1,2)}-${safePassword.slice(2,3)}-${safePassword.slice(3,4)}</strong>`,
                            'è¿™çœ‹èµ·æ¥åƒæ˜¯ä¿é™©ç®±çš„å¯†ç ï¼');
                    } else {
                        showModal(drawerData.name, drawerData.description, 'ä½ éœ€è¦æ‰¾åˆ°é’¥åŒ™æ‰èƒ½æ‰“å¼€å®ƒã€‚');
                    }
                    return;
                }

                // å¤„ç†ä¿é™©ç®±çš„äº¤äº’é€»è¾‘
                if (objectName === 'safe') {
                    showPasswordModal('safe', safePassword, 'ğŸ”’ ä¿é™©ç®±å¯†ç ');
                    return;
                }

                // å¤„ç†é—¨çš„äº¤äº’é€»è¾‘
                if (objectName === 'door') {
                    if (collectedItems.includes('safe_content')) {
                        showPasswordModal('door', doorPassword, 'ğŸšª é—¨é”å¯†ç ');
                    } else {
                        showModal(itemData['door'].name, itemData['door'].description, 'ä½ éœ€è¦æ‰¾åˆ°æ‰“å¼€è¿™æ‰‡é—¨çš„æ–¹æ³•...');
                    }
                    return;
                }

                if (objectName && itemData[objectName]) {
                    const item = itemData[objectName];

                    // å¯¹äºæ™®é€šç‰©å“ï¼ˆéç›†æ ½ç­‰ç‰¹æ®Šç‰©å“ï¼‰
                    if (objectName !== 'plant') {
                        showModal(item.name, item.description, item.hint);

                        // æ£€æŸ¥æ˜¯å¦å¯ä»¥æ”¶é›†
                        if (item.canCollect && !item.collected) {
                            collectItem(objectName);
                        }
                    }
                }
            }
        }

        // ==================== ç‰©å“æ”¶é›† ====================
        function collectItem(itemName) {
            const item = itemData[itemName];
            if (!item || item.collected) return;

            item.collected = true;
            collectedItems.push(itemName);

            soundManager.playSuccessSound();
            soundManager.vibrateSuccess();

            // éšè—ç‰©å“
            const obj = interactiveObjects.find(obj => obj.name === itemName);
            if (obj) {
                obj.visible = false;
            }

            // æ›´æ–°ç‰©å“æ 
            updateInventory();

            // æ˜¾ç¤ºæ”¶é›†æç¤º
            showHint(`è·å¾—ç‰©å“: ${item.name}`);
        }

        function updateInventory() {
            const content = document.getElementById('inventoryContent');
            
            if (collectedItems.length === 0) {
                content.innerHTML = `
                    <div class="inventory-empty">
                        è¿˜æ²¡æœ‰æ”¶é›†ä»»ä½•ç‰©å“<br>
                        æ¢ç´¢æˆ¿é—´æ¥å‘ç°çº¿ç´¢å§ï¼
                    </div>
                `;
                return;
            }

            content.innerHTML = collectedItems.map(itemName => {
                const item = itemData[itemName];
                return `
                    <div class="inventory-item" onclick="showItemDetail('${itemName}')">
                        <div class="inventory-item-icon">${getItemIcon(itemName)}</div>
                        <div class="inventory-item-name">${item.name}</div>
                        <div class="inventory-item-desc">${item.description.substring(0, 50)}...</div>
                    </div>
                `;
            }).join('');
        }

        function getItemIcon(itemName) {
            const icons = {
                'paper': 'ğŸ“„',
                'diary': 'ğŸ“”',
                'key': 'ğŸ”‘',
                'safe_content': 'ğŸ”‘'
            };
            return icons[itemName] || 'ğŸ“¦';
        }

        // æ˜¾ç¤ºç‰©å“è¯¦æƒ…
        window.showItemDetail = function(itemName) {
            const item = itemData[itemName];
            if (item) {
                showModal(item.name, item.description, item.hint);
            }
        };

        // ==================== UIåŠŸèƒ½ ====================
        function showModal(title, description, hint) {
            document.getElementById('modalTitle').textContent = title;

            let descText = typeof description === 'function' ? description() : description;
            let contentHtml = `<p>${descText}</p>`;
            
            // å›°éš¾æ¨¡å¼ä¸æ˜¾ç¤ºæç¤º
            if (currentDifficulty !== 'hard' && hint) {
                contentHtml += `<div class="modal-hint">ğŸ’¡ ${hint}</div>`;
            }
            
            document.getElementById('modalContent').innerHTML = contentHtml;
            document.getElementById('itemModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('itemModal').classList.remove('active');
        }

        let currentPassword = '';
        let currentSafeType = '';

        function showPasswordModal(safeType, correctPassword, title) {
            currentPassword = '';
            currentSafeType = safeType;
            updatePasswordDisplay();
            document.getElementById('passwordTitle').textContent = title;
            const expectedLength = currentDifficulty === 'hard' && safeType === 'safe' ? 6 : (correctPassword.length || 4);
            document.getElementById('passwordHint').textContent = `è¯·è¾“å…¥${expectedLength}ä½å¯†ç `;
            document.getElementById('passwordModal').classList.add('active');
        }

        function closePasswordModal() {
            document.getElementById('passwordModal').classList.remove('active');
            currentPassword = '';
            currentSafeType = '';
        }

        function updatePasswordDisplay() {
            const display = document.getElementById('passwordDisplay');
            const maxLength = currentDifficulty === 'hard' && currentSafeType === 'safe' ? 5 : 4;
            const dots = currentPassword.padEnd(maxLength, '-');
            display.textContent = dots.split('').join(' ');
        }

        function handlePasswordDigit(digit) {
            if (digit === 'clear') {
                currentPassword = '';
            } else if (digit === 'enter') {
                checkPassword();
                return;
            } else {
                const maxLength = currentDifficulty === 'hard' ? 5 : 4;
                if (currentPassword.length < maxLength) {
                    currentPassword += digit;
                }
            }
            updatePasswordDisplay();
        }

        function checkPassword() {
            // å›°éš¾æ¨¡å¼é€»è¾‘
            if (currentDifficulty === 'hard') {
                const now = Date.now();
                if (now < hardModeData.lockoutEndTime) {
                    const remaining = Math.ceil((hardModeData.lockoutEndTime - now) / 1000);
                    showHint(`ç³»ç»Ÿé”å®šä¸­... å‰©ä½™ ${remaining} ç§’`);
                    return;
                }

                if (currentSafeType === 'safe') {
                    // å‡å¯†ç é™·é˜±
                    const fakeEnvelope = hardModeData.fakeNumbers?.envelopeFull || '12345';
                    const fakeTrash = hardModeData.fakeNumbers?.trashFull || '66666';
                    
                    if (currentPassword === fakeEnvelope || currentPassword === fakeTrash) {
                        timeRemaining = Math.max(0, timeRemaining - 120); // æ‰£é™¤2åˆ†é’Ÿ
                        showModal('âš ï¸ ç³»ç»Ÿè­¦å‘Š', 'æ£€æµ‹åˆ°éæ³•è®¿é—®ï¼', 'æƒ©ç½šï¼šæ—¶é—´æ‰£é™¤2åˆ†é’Ÿ');
                        soundManager.playErrorSound();
                        soundManager.vibrateError();
                        currentPassword = '';
                        updatePasswordDisplay();
                        return;
                    }

                    // çœŸå¯†ç æ£€æŸ¥
                    if (currentPassword === hardModeData.truePassword) {
                        gameComplete(); // çœŸç»“å±€
                    } else {
                        // é”™è¯¯å¤„ç†
                        hardModeData.penalties++;
                        let lockoutTime = 0;
                        if (hardModeData.penalties === 1) lockoutTime = 5000;
                        if (hardModeData.penalties >= 3) {
                            lockoutTime = 30000;
                            shuffleKeypad(); // é”™è¯¯3æ¬¡æ‰“ä¹±é”®ç›˜
                        }

                        if (lockoutTime > 0) {
                            hardModeData.lockoutEndTime = Date.now() + lockoutTime;
                            showHint(`å¯†ç é”™è¯¯ï¼ç³»ç»Ÿé”å®š ${lockoutTime/1000} ç§’`);
                        } else {
                            showHint('å¯†ç é”™è¯¯ï¼');
                        }

                        document.getElementById('passwordDisplay').textContent = 'ERR';
                        document.getElementById('passwordDisplay').style.color = '#ff6464';
                        document.getElementById('passwordDisplay').style.borderColor = '#ff6464';
                        soundManager.playErrorSound();
                        soundManager.vibrateError();
                        setTimeout(() => {
                            currentPassword = '';
                            document.getElementById('passwordDisplay').style.color = currentDifficulty === 'hard' ? '#ff4444' : '#00ff88';
                            document.getElementById('passwordDisplay').style.borderColor = currentDifficulty === 'hard' ? '#ff4444' : '#00ff88';
                            updatePasswordDisplay();
                        }, 800);
                    }
                }
                return;
            }

            // ç®€å•æ¨¡å¼é€»è¾‘ (ä¿æŒä¸å˜)
            const safeData = itemData[currentSafeType];
            
            if (currentSafeType === 'safe' && currentPassword === safePassword) {
                if (safeData.opened) {
                    closePasswordModal();
                    showModal(safeData.name, 'ä¿é™©ç®±å·²ç»æ‰“å¼€äº†ï¼Œé‡Œé¢ç©ºç©ºå¦‚ä¹Ÿã€‚', '');
                } else {
                    safeData.opened = true;
                    closePasswordModal();
                    collectItem('safe_content');
                    showModal('ğŸ”“ ä¿é™©ç®±å·²æ‰“å¼€ï¼', 
                        `ä½ æˆåŠŸæ‰“å¼€äº†ä¿é™©ç®±ï¼åœ¨é‡Œé¢çš„çº¸æ¡ä¸Šå†™ç€ä¸€ä¸²æ•°å­—ï¼š<strong>${doorPassword.slice(0,1)}-${doorPassword.slice(1,2)}-${doorPassword.slice(2,3)}-${doorPassword.slice(3,4)}</strong>ï¼Œè¿˜æœ‰ä¸€æŠŠé‡‘è‰²çš„é’¥åŒ™ï¼`,
                        'è¿™ä¸€å®šæ˜¯å¼€é—¨ç”¨çš„å¯†ç å’Œé’¥åŒ™ï¼');
                }
            } else if (currentSafeType === 'door' && currentPassword === doorPassword) {
                if (collectedItems.includes('safe_content')) {
                    closePasswordModal();
                    gameComplete();
                } else {
                    closePasswordModal();
                    showModal(itemData['door'].name, 'å¯†ç æ­£ç¡®ï¼Œä½†ä½ æ²¡æœ‰é’¥åŒ™...', 'ä½ éœ€è¦æ‰¾åˆ°é’¥åŒ™æ‰èƒ½æ‰“å¼€è¿™æ‰‡é—¨ã€‚');
                }
            } else {
                document.getElementById('passwordDisplay').textContent = 'ERR';
                document.getElementById('passwordDisplay').style.color = '#ff6464';
                document.getElementById('passwordDisplay').style.borderColor = '#ff6464';
                soundManager.playErrorSound();
                soundManager.vibrateError();
                setTimeout(() => {
                    currentPassword = '';
                    document.getElementById('passwordDisplay').style.color = '#00ff88';
                    document.getElementById('passwordDisplay').style.borderColor = '#00ff88';
                    updatePasswordDisplay();
                }, 800);
            }
        }

        function toggleInventory() {
            document.getElementById('inventoryPanel').classList.toggle('active');
        }

        function resetView() {
            camera.position.set(4, 3, 5);
            controls.target.set(0, 1.5, 0);
            controls.update();
        }

        function showHint(text) {
            const hint = document.getElementById('actionHint');
            hint.textContent = text;
            hint.classList.add('visible');
            setTimeout(() => {
                hint.classList.remove('visible');
            }, 2000);
        }

        // ==================== åŠ¨ç”»å¾ªç¯ ====================
        let frameCount = 0;
        let lastTime = performance.now();

        function animate() {
            requestAnimationFrame(animate);

            // åªæœ‰åœ¨æ¸¸æˆä¸­æ‰æ›´æ–°
            if (gameMode !== 'playing' || !scene) return;

            // FPSè®¡ç®—
            frameCount++;
            const currentTime = performance.now();
            if (currentTime - lastTime >= 1000) {
                document.getElementById('fpsValue').textContent = frameCount;
                frameCount = 0;
                lastTime = currentTime;
            }

            // æ›´æ–°æ§åˆ¶å™¨
            controls.update();

            // æ›´æ–°æŒ‚é’ŸæŒ‡é’ˆï¼ˆå®æ—¶æ˜¾ç¤ºæ—¶é—´ï¼‰
            if (clockHands.hour && clockHands.minute) {
                const now = new Date();
                const hours = now.getHours() % 12;
                const minutes = now.getMinutes();
                const seconds = now.getSeconds();

                // æ—¶é’ˆè§’åº¦ï¼š(å°æ—¶ + åˆ†é’Ÿ/60) * 30åº¦
                clockHands.hour.rotation.z = -(hours + minutes / 60) * (Math.PI / 6);
                // åˆ†é’ˆè§’åº¦ï¼šåˆ†é’Ÿ * 6åº¦
                clockHands.minute.rotation.z = -minutes * (Math.PI / 6);
                // ç§’é’ˆè§’åº¦ï¼šç§’é’Ÿ * 6åº¦ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
            }

            // æ¸²æŸ“åœºæ™¯
            renderer.render(scene, camera);
        }

        // ==================== å›°éš¾æ¨¡å¼é€»è¾‘ ====================
        
        /**
         * åˆå§‹åŒ–åŠ¨æ€é¢œè‰²é˜ˆå€¼ï¼ˆæ¯å±€æ¸¸æˆè°ƒç”¨ä¸€æ¬¡ï¼‰
         * åŠ¨æ€é˜ˆå€¼è§„åˆ™ï¼š
         * - Råˆ†é‡ï¼šéšæœºç”Ÿæˆ[240, 255]åŒºé—´çš„æ•´æ•°ä½œä¸ºæœ€å°å€¼
         * - Gåˆ†é‡ï¼šéšæœºç”Ÿæˆ[0, 15]åŒºé—´çš„æ•´æ•°ä½œä¸ºæœ€å¤§å€¼
         * - Båˆ†é‡ï¼šéšæœºç”Ÿæˆ[0, 15]åŒºé—´çš„æ•´æ•°ä½œä¸ºæœ€å¤§å€¼
         * çœŸçº¢åˆ¤å®šï¼šR >= redMin ä¸” G <= greenMax ä¸” B <= blueMax
         */
        function initColorThresholds() {
            hardModeData.colorThresholds = {
                redMin: Math.floor(Math.random() * 16) + 240,  // [240, 255]
                greenMax: Math.floor(Math.random() * 16),       // [0, 15]
                blueMax: Math.floor(Math.random() * 16)           // [0, 15]
            };
            console.log(`åŠ¨æ€é¢œè‰²é˜ˆå€¼å·²ç”Ÿæˆ: Râ‰¥${hardModeData.colorThresholds.redMin}, Gâ‰¤${hardModeData.colorThresholds.greenMax}, Bâ‰¤${hardModeData.colorThresholds.blueMax}`);
        }
        
        /**
         * åˆ¤å®šé¢œè‰²æ˜¯å¦ä¸º"çœŸçº¢"
         * @param {number} r - çº¢è‰²åˆ†é‡ (0-255)
         * @param {number} g - ç»¿è‰²åˆ†é‡ (0-255)
         * @param {number} b - è“è‰²åˆ†é‡ (0-255)
         * @returns {boolean} æ˜¯å¦ä¸ºçœŸçº¢
         */
        function isTrueRed(r, g, b) {
            const { redMin, greenMax, blueMax } = hardModeData.colorThresholds;
            return r >= redMin && g <= greenMax && b <= blueMax;
        }
        
        /**
         * ç”ŸæˆæŒ‡å®šæ•°é‡çš„çº¢è‰²ç‰©å“é¢œè‰²ï¼ˆç¡®ä¿ç¬¦åˆå½“å±€é˜ˆå€¼ï¼‰
         * @param {number} count - éœ€è¦ç”Ÿæˆçš„çº¢è‰²ç‰©å“æ•°é‡
         * @returns {Array} é¢œè‰²å€¼æ•°ç»„
         */
        function generateRedColors(count) {
            const { redMin, greenMax, blueMax } = hardModeData.colorThresholds;
            const colors = [];
            for (let i = 0; i < count; i++) {
                const r = Math.floor(Math.random() * (255 - redMin)) + redMin;
                const g = Math.floor(Math.random() * (greenMax + 1));
                const b = Math.floor(Math.random() * (blueMax + 1));
                colors.push({ r, g, b, hex: (r << 16) | (g << 8) | b });
            }
            return colors;
        }
        
        function initHardMode() {
            // 0. åˆå§‹åŒ–åŠ¨æ€é¢œè‰²é˜ˆå€¼ï¼ˆç‹¬ç«‹äºå…¶ä»–éšæœºé€»è¾‘ï¼‰
            initColorThresholds();
            
            // 1. éšæœºç”Ÿæˆç”»æ¡†ä¸­ç‰©å“çš„æ•°é‡
            // ç¡®ä¿çº¢è‹¹æœå’Œçº¢èŠ±çš„æ€»æ•°åœ¨1-9ä¹‹é—´ï¼Œä½œä¸ºå¯†ç ç¬¬1ä½
            const appleCount = Math.floor(Math.random() * 5) + 1; // 1-5
            const flowerCount = Math.floor(Math.random() * 4) + 1; // 1-4
            const peachCount = Math.floor(Math.random() * 3) + 1; // 1-3
            const orangeCount = Math.floor(Math.random() * 3) + 1; // 1-3
            
            hardModeData.itemCounts = {
                apple: appleCount,
                flower: flowerCount,
                peach: peachCount,
                orange: orangeCount
            };
            
            const trueRedCount = appleCount + flowerCount;
            hardModeData.trueRedCount = trueRedCount; // å­˜å‚¨ä»¥ä¾¿äº¤äº’æ—¶å¼•ç”¨
            
            // 2. ç”Ÿæˆå¯†ç 
            const now = new Date();
            const hour = now.getHours().toString().padStart(2, '0');
            const minute = now.getMinutes().toString().padStart(2, '0');
            const p1 = trueRedCount; // 1-9 ä¹‹é—´çš„æ•°å­—
            const p2_3 = minute;
            const p4_5 = hour.split('').reverse().join('');
            hardModeData.truePassword = `${p1}${p2_3}${p4_5}`;
            hardModeData.isTrashReal = Math.random() > 0.5;

            // ç”Ÿæˆéšæœºå¹²æ‰°æ•°å­—
            hardModeData.fakeNumbers = {
                trashDigit: Math.floor(Math.random() * 9) + 1, // éšæœº 1-9
                trashFull: Array(5).fill(Math.floor(Math.random() * 9) + 1).join(''), // éšæœº 5ä½é‡å¤æ•°å­—
                envelopeFull: Math.floor(10000 + Math.random() * 90000).toString() // éšæœº 5ä½æ•°å­—
            };
            
            // 3. é‡ç½®æ•°æ®
            hardModeData.cluesFound = [];
            hardModeData.notes = [];
            hardModeData.penalties = 0;
            updateNotePanel();

            // 4. è®¾ç½®å›°éš¾æ¨¡å¼ä¸“å±ç‰©å“æ•°æ®
            itemData['trash'] = {
                name: 'åƒåœ¾æ¡¶',
                description: 'ä¸€ä¸ªæ™®é€šçš„åƒåœ¾æ¡¶ï¼Œé‡Œé¢å¥½åƒæœ‰ä¸œè¥¿ã€‚',
                hint: '',
                canCollect: false,
                isInteractive: true
            };
            
            itemData['painting'] = {
                name: 'é™ç‰©ç”»',
                description: 'ä¸€å¹…é™ç‰©æ²¹ç”»ï¼Œç”»ç€ä¸€äº›æ°´æœå’ŒèŠ±ã€‚',
                hint: '',
                canCollect: false,
                isInteractive: true
            };

            itemData['safe'].description = 'éœ€è¦è¾“å…¥5ä½å¯†ç ã€‚æç¤ºï¼šå¯†ç ä¸"é¢œè‰²"å’Œ"æ—¶é—´"æœ‰å…³ã€‚';
            // ä¿é™©ç®±é€»è¾‘åœ¨äº¤äº’æ—¶åŠ¨æ€å¤„ç†
            
            createHardModeObjects();
        }

        function createHardModeObjects() {
            if (!scene) return;

            // åœ°æ¯¯
            if (!scene.getObjectByName('carpet')) {
                const carpetGeo = new THREE.BoxGeometry(2, 0.05, 3);
                const carpetMat = new THREE.MeshStandardMaterial({ color: 0x552222, roughness: 0.9 });
                const carpet = new THREE.Mesh(carpetGeo, carpetMat);
                carpet.position.set(0, 0.02, 0); // æ”¾åœ¨æˆ¿é—´ä¸­é—´
                carpet.name = 'carpet';
                carpet.receiveShadow = true;
                scene.add(carpet);
                interactiveObjects.push(carpet);
                
                itemData['carpet'] = {
                    name: 'æ—§åœ°æ¯¯',
                    description: 'ä¸€å—æ—§åœ°æ¯¯ã€‚',
                    hint: '',
                    canCollect: false,
                    isInteractive: true
                };
            }

            // ä¿¡å°
            if (!scene.getObjectByName('envelope')) {
                const envelopeGeo = new THREE.BoxGeometry(0.4, 0.02, 0.3);
                const envelopeMat = new THREE.MeshStandardMaterial({ color: 0xffffee, roughness: 0.6 });
                const envelope = new THREE.Mesh(envelopeGeo, envelopeMat);
                envelope.position.set(-0.5, 0.82, 0.5); // æ”¾åœ¨æ¡Œå­ä¸Š
                envelope.rotation.y = 0.2;
                envelope.name = 'envelope';
                envelope.castShadow = true;
                scene.add(envelope);
                interactiveObjects.push(envelope);

                itemData['envelope'] = {
                    name: 'ç¥ç§˜ä¿¡å°',
                    description: 'ä¸€ä¸ªç¥ç§˜çš„ä¿¡å°ï¼Œçœ‹èµ·æ¥å¾ˆè¯±äººã€‚',
                    hint: '',
                    canCollect: false,
                    isInteractive: true
                };
            }
        }

        function checkAFK() {
            if (gameMode !== 'playing' || currentDifficulty !== 'hard') return;
            const now = Date.now();
            if (now - hardModeData.lastActionTime > 90000) { // 90ç§’
                shuffleClueLocations();
                hardModeData.lastActionTime = now;
                showHint('ä½ å‘å‘†å¤ªä¹…äº†ï¼Œæˆ¿é—´é‡Œçš„ä¸œè¥¿ä¼¼ä¹ç§»åŠ¨äº†ä½ç½®...');
                soundManager.playErrorSound();
            }
        }

        function shuffleClueLocations() {
             const items = ['trash', 'painting', 'carpet', 'envelope'];
             const objects = items.map(name => scene.getObjectByName(name)).filter(obj => obj);
             
             if (objects.length < 2) return;

             // ç®€å•çš„ä½ç½®éšæœºåŒ–ï¼šéšæœºäº¤æ¢ä¸¤ä¸ªç‰©ä½“çš„ä½ç½®
             const idx1 = Math.floor(Math.random() * objects.length);
             let idx2 = Math.floor(Math.random() * objects.length);
             while(idx1 === idx2) idx2 = Math.floor(Math.random() * objects.length);

             const obj1 = objects[idx1];
             const obj2 = objects[idx2];
             
             const tempPos = obj1.position.clone();
             const tempRot = obj1.rotation.clone();
             
             obj1.position.copy(obj2.position);
             obj1.rotation.copy(obj2.rotation);
             
             obj2.position.copy(tempPos);
             obj2.rotation.copy(tempRot);
        }
        
        // ç¬”è®°ç³»ç»Ÿ
        function addNote(text, type = 'normal') {
            const note = { text, type, time: new Date().toLocaleTimeString() };
            hardModeData.notes.push(note);
            updateNotePanel();
            
            // æŒ‰é’®é—ªçƒæç¤º
            const btn = document.getElementById('noteBtn');
            btn.style.color = '#fff';
            setTimeout(() => btn.style.color = '#ffd700', 500);
        }

        function updateNotePanel() {
            const content = document.getElementById('noteContent');
            if (hardModeData.notes.length === 0) {
                content.innerHTML = '<p style="color:#666;font-style:italic;">æš‚æ— è®°å½•...</p>';
                return;
            }
            
            let html = '';
            // è‡ªåŠ¨ç”Ÿæˆçš„æ¨ç†éƒ¨åˆ†
            html += '<h4>ã€æˆ‘çš„æ¨ç†ã€‘</h4>';
            html += '<div class="note-item">ç›®æ ‡ï¼š5ä½å¯†ç </div>';
            html += '<div class="note-item">ç¬¬1ä½ï¼šå¯èƒ½ä¸çº¢è‰²ç‰©å“æœ‰å…³</div>';
            html += '<div class="note-item">ç¬¬2-3ä½ï¼šå¯èƒ½ä¸æ—¶é—´æœ‰å…³</div>';
            
            html += '<h4>ã€çº¿ç´¢è®°å½•ã€‘</h4>';
            hardModeData.notes.forEach(note => {
                let className = 'note-item';
                if (note.type === 'verified') className += ' verified';
                if (note.type === 'suspicious') className += ' suspicious';
                if (note.type === 'real') className += ' clue-real';
                if (note.type === 'fake') className += ' clue-fake';
                html += `<div class="${className}">${note.text}</div>`;
            });
            content.innerHTML = html;
        }

        // å›°éš¾æ¨¡å¼äº¤äº’å¤„ç†
        function handleHardModeInteraction(objectName, isLongPress) {
            hardModeData.lastActionTime = Date.now();
            
            // 1. åƒåœ¾æ¡¶
            if (objectName === 'trash') {
                if (isLongPress) {
                    showModal('åƒåœ¾æ¡¶', 'æ²¡ä»€ä¹ˆç‰¹åˆ«çš„ã€‚', '');
                } else {
                    const rand = Math.random();
                    let content = '';
                    let style = '';
                    
                    if (rand < 0.35) { // çœŸçº¿ç´¢
                        style = 'color: #000; font-weight: bold; background: #fff; padding: 10px; border: 1px solid #000;';
                        content = `<div style="${style}">ã€è§‚å¯Ÿç¬”è®°ã€‘<br>å¯†ç ç¬¬1ä½ = æˆ¿é—´é‡Œçº¯çº¢è‰²ç‰©å“æ€»æ•°</div>`;
                        addNote('åƒåœ¾æ¡¶ï¼šç¬¬1ä½ = çº¯çº¢è‰²ç‰©å“æ•°', 'real');
                    } else if (rand < 0.7) { // å‡çº¿ç´¢A
                        const fakeDigit = hardModeData.fakeNumbers?.trashDigit || 6;
                        style = 'color: #888; background: #eee; padding: 10px; border: 1px solid #ccc; text-decoration: line-through;';
                        content = `<div style="${style}">ã€è§‚å¯Ÿç¬”è®°ã€‘<br>å¯†ç ç¬¬1ä½ = ${fakeDigit}<br><small>å¥½åƒæ•°é”™äº†ï¼Ÿ</small></div>`;
                        addNote(`åƒåœ¾æ¡¶ï¼šç¬¬1ä½ = ${fakeDigit}`, 'suspicious');
                    } else { // å‡çº¿ç´¢B
                        const fakeFull = hardModeData.fakeNumbers?.trashFull || '66666';
                        style = 'color: #f00; font-family: cursive; background: #ffcccc; padding: 10px; border: 1px solid #f00;';
                        content = `<div style="${style}">ã€ç´§æ€¥æç¤ºã€‘<br>åˆ«ç›¸ä¿¡ç”»é‡Œçš„é¢œè‰²ï¼å¯†ç æ˜¯${fakeFull}ï¼</div>`;
                        addNote(`åƒåœ¾æ¡¶ï¼šå¯†ç æ˜¯${fakeFull}`, 'fake');
                    }
                    
                    showModal('åƒåœ¾æ¡¶é‡Œçš„çº¸æ¡', content, '');
                }
                return;
            }

            // 2. ç”»æ¡†
            if (objectName === 'painting') {
                if (isLongPress) {
                    const { redMin, greenMax, blueMax } = hardModeData.colorThresholds;
                    showModal('ç”»æ¡†è¾¹æ¡†', `æœ¬å±€çœŸçº¢åˆ¤å®šæ ‡å‡†ï¼š<br><br><span style="color:#ff4444;font-weight:bold;">R â‰¥ ${redMin}</span><br><span style="color:#44ff44;">G â‰¤ ${greenMax}</span><br><span style="color:#4444ff;">B â‰¤ ${blueMax}</span><br><br>æ•°ä¸€æ•°ç”»é‡Œæœ‰å¤šå°‘ç¬¦åˆè¯¥æ ‡å‡†çš„ç‰©å“ï¼Ÿ`, 'åŒå‡»è§¦å‘çš„åŠ¨æ€åˆ¤å®šæ ‡å‡†ï¼');
                    addNote(`ç”»æ¡†æç¤ºï¼šçœŸçº¢æ ‡å‡† Râ‰¥${redMin}, Gâ‰¤${greenMax}, Bâ‰¤${blueMax}`, 'verified');
                } else {
                    const { redMin, greenMax, blueMax } = hardModeData.colorThresholds;
                    const counts = hardModeData.itemCounts || { apple: 1, flower: 1, peach: 1, orange: 1 };
                    
                    // ç”Ÿæˆéšæœºé¢œè‰²çš„ç‰©å“
                    const apple = generateRedColors(1)[0]; 
                    const flower = generateRedColors(1)[0]; 
                    
                    const peachColor = { r: 255, g: 192, b: 203 }; // ç²‰è‰²
                    const orangeColor = { r: 255, g: 140, b: 0 }; // æ©™è‰²
                    
                    let html = `<div class="clue-visual"><div style="color:white;text-align:center;">[æ°´æœé™ç‰©ç”»]<br>`;
                    
                    // æ˜¾ç¤ºçº¢è‹¹æœåŠå…¶æ•°é‡å’ŒRGB
                    html += `<span class="color-sample" style="background:rgb(${apple.r},${apple.g},${apple.b});"></span>çº¢è‹¹æœ *${counts.apple} (R:${apple.r} G:${apple.g} B:${apple.b})<br>`;
                    
                    // æ˜¾ç¤ºçº¢èŠ±åŠå…¶æ•°é‡å’ŒRGB
                    html += `<span class="color-sample" style="background:rgb(${flower.r},${flower.g},${flower.b});"></span>çº¢èŠ± *${counts.flower} (R:${flower.r} G:${flower.g} B:${flower.b})<br>`;
                    
                    html += `<span class="color-sample" style="background:rgb(${peachColor.r},${peachColor.g},${peachColor.b});"></span>ç²‰æ¡ƒå­ *${counts.peach} (R:${peachColor.r} G:${peachColor.g} B:${peachColor.b})<br>`;
                    html += `<span class="color-sample" style="background:rgb(${orangeColor.r},${orangeColor.g},${orangeColor.b});"></span>æ©™æ©˜å­ *${counts.orange} (R:${orangeColor.r} G:${orangeColor.g} B:${orangeColor.b})<br>`;
                    
                    html += `</div></div>`;
                    
                    showModal('é™ç‰©ç”»', html, '');
                    addNote(`è§‚å¯Ÿç”»ä½œï¼šçœ‹åˆ°è‹¹æœ*${counts.apple}, èŠ±*${counts.flower}ç­‰ç‰©å“`);
                }
                return;
            }

            // 3. åœ°æ¯¯
            if (objectName === 'carpet') {
                if (isLongPress) {
                    const html = `
                        <div style="background:#fff;color:#000;padding:15px;font-family:monospace;">
                            <h3>ã€æ—¶é—´å¯†ç ã€‘</h3>
                            <p>ç¬¬2-3ä½ = å½“å‰åˆ†é’Ÿï¼ˆ00-59ï¼‰</p>
                            <p>ç¬¬4-5ä½ = å½“å‰å°æ—¶å€’åº</p>
                            <p>æ³¨æ„ï¼š24å°æ—¶åˆ¶ï¼Œä¸è¶³è¡¥0</p>
                        </div>
                    `;
                    showModal('åœ°æ¯¯ä¸‹çš„çº¸æ¡', html, 'ç‚¹å‡»2æ¬¡è§¦å‘çš„éšè—çº¿ç´¢ï¼');
                    addNote('åœ°æ¯¯çº¿ç´¢ï¼š2-3ä½=åˆ†é’Ÿï¼Œ4-5ä½=å°æ—¶å€’åº', 'verified');
                } else {
                    showModal('æ—§åœ°æ¯¯', 'ä¸€å—æ™®é€šçš„åœ°æ¯¯ï¼Œä¼¼ä¹æœ‰ç‚¹ä¸å¹³æ•´ã€‚', 'è¯•ç€è¿ç»­ç‚¹å‡»çœ‹çœ‹ï¼Ÿ');
                }
                return;
            }

            // 4. ä¿¡å°
            if (objectName === 'envelope') {
                const fakeEnvelope = hardModeData.fakeNumbers?.envelopeFull || '12345';
                const html = `<div style="background:#ffefef;color:#900;padding:15px;border:1px solid #f66;">ã€ç´§æ€¥æç¤ºã€‘<br>å¯†ç æ˜¯<strong>${fakeEnvelope}</strong>ï¼ä¸è¦çŠ¹è±«ï¼</div>`;
                showModal('ç¥ç§˜ä¿¡å°', html, '');
                addNote(`ä¿¡å°ç»™å‡º${fakeEnvelope}`, 'fake');
                return;
            }

            // 5. ä¿é™©ç®±
            if (objectName === 'safe') {
                const collectedCount = hardModeData.notes.length;
                let desc = `éœ€è¦5ä½å¯†ç <br>ä½ å·²æ”¶é›† ${collectedCount} æ¡ç›¸å…³çº¿ç´¢`;
                if (collectedCount < 3) desc += '<br>[è­¦å‘Šï¼šçº¿ç´¢ä¸è¶³ï¼Œå»ºè®®ç»§ç»­å¯»æ‰¾]';
                
                showPasswordModal('safe', hardModeData.truePassword, 'ğŸ”’ æœ€ç»ˆä¿é™©ç®±');
                // æ¯æ¬¡æ‰“å¼€æ‰“ä¹±é”®ç›˜
                shuffleKeypad();
                // è®¾ç½®å½“å‰è¾“å…¥ç›®æ ‡ä¸ºsafe_hard
                const modal = document.getElementById('passwordModal');
                modal.dataset.target = 'safe_hard';
                modal.dataset.length = 5; // æ˜ç¡®æŒ‡å®š 5 ä½
                document.getElementById('passwordHint').innerHTML = desc;
                // é‡ç½®å¯†ç æ˜¾ç¤ºé•¿åº¦
                document.getElementById('passwordDisplay').textContent = '-----';
                return;
            }

            // é»˜è®¤ç‰©å“å¤„ç†ï¼ˆå…¶ä»–æ‰€æœ‰ç‰©å“ï¼‰
            const itemDesc = itemDescriptions[objectName];
            if (itemDesc) {
                if (isLongPress) {
                    showModal(itemDesc.name, itemDesc.description, itemDesc.hint);
                } else {
                    showModal(itemDesc.name, itemDesc.description, itemDesc.hint);
                }
            } else {
                showModal('æœªçŸ¥ç‰©å“', 'ä½ å‘ç°äº†ä»€ä¹ˆå¥‡æ€ªçš„ä¸œè¥¿...', 'ä»”ç»†è°ƒæŸ¥ä¸€ä¸‹ã€‚');
            }
            return;
        }
        
        function shuffleKeypad() {
             const keypad = document.querySelector('.keypad');
             const buttons = Array.from(keypad.querySelectorAll('.key-btn:not(.key-clear):not(.key-enter)'));
             buttons.forEach(btn => {
                 btn.style.order = Math.floor(Math.random() * 10);
             });
        }
        
        // ç»‘å®šç¬”è®°é¢æ¿äº‹ä»¶
        document.getElementById('noteBtn').addEventListener('click', () => {
            document.getElementById('notePanel').classList.add('visible');
        });
        document.getElementById('closeNote').addEventListener('click', () => {
            document.getElementById('notePanel').classList.remove('visible');
        });
        // åˆå§‹åŒ–éŸ³é¢‘ç³»ç»Ÿï¼ˆç­‰å¾…ç”¨æˆ·äº¤äº’ï¼‰
        soundManager.init();
        
        // éšè—åŠ è½½ç•Œé¢ï¼Œæ˜¾ç¤ºå¼€å§‹ç•Œé¢
        document.getElementById('loadingScreen').classList.add('hidden');
        document.getElementById('startScreen').classList.remove('hidden');
        
        // åŠ è½½æœ€ä½³çºªå½•
        loadBestRecords();

        // ç»‘å®šéš¾åº¦é€‰æ‹©ä¸é‡è¯•æŒ‰é’®ï¼ˆç¡®ä¿æ— éœ€åˆå§‹åŒ–3Då³å¯ç‚¹å‡»ï¼‰
        const easyBtn = document.getElementById('easyBtn');
        const hardBtn = document.getElementById('hardBtn');
        const retryBtn = document.getElementById('retryBtn');
        const restartBtn = document.getElementById('restartBtn');
        if (easyBtn) {
            easyBtn.addEventListener('click', () => {
                soundManager.playClickSound();
                startGame('easy');
            }, { once: false });
        }
        if (hardBtn) {
            hardBtn.addEventListener('click', () => {
                soundManager.playClickSound();
                startGame('hard');
            }, { once: false });
        }
        if (retryBtn) {
            retryBtn.addEventListener('click', () => {
                soundManager.playClickSound();
                restartGame();
            }, { once: false });
        }
        if (restartBtn) {
            restartBtn.addEventListener('click', () => {
                soundManager.playClickSound();
                restartGame();
            }, { once: false });
        }
        
        // å¯åŠ¨åŠ¨ç”»å¾ªç¯ï¼ˆç­‰å¾…é€‰æ‹©éš¾åº¦åå†æ¸²æŸ“ï¼‰
        animate();
    </script>
</body>
</html>
